<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Plasma Hall of Fame</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-emerald-900 via-teal-900 to-green-900 text-white overflow-hidden relative">

<!-- Background Animations -->
<div class="absolute inset-0 overflow-hidden">
    <div class="plasma-bg absolute inset-0"></div>
    <div class="spinning-circle absolute inset-0 flex items-center justify-center">
        <div class="loading-spinner"></div>
    </div>
    <div class="stars absolute inset-0"></div>
</div>

<!-- Audio -->
<audio id="bgMusic" loop preload="auto">
    <source src="./interstellar.mp3" type="audio/mpeg">
</audio>

<!-- Header -->
<header class="relative z-10 text-center py-8">
    <div class="flex items-center justify-center mb-4">
        <svg width="80" height="80" viewBox="0 0 100 100" class="w-16 h-16 mr-4 animate-spin" style="animation-duration: 3s;">
            <defs>
                <style>
                    .segment { fill: white; }
                </style>
            </defs>
            <g transform="translate(50,50)">
                <!-- Segmented circle with gaps like the image -->
                <path d="M 0,-45 A 45,45 0 0,1 31.82,-31.82" class="segment" />
                <path d="M 36.82,-26.82 A 45,45 0 0,1 45,0" class="segment" />
                <path d="M 45,5 A 45,45 0 0,1 31.82,31.82" class="segment" />
                <path d="M 26.82,36.82 A 45,45 0 0,1 0,45" class="segment" />
                <path d="M -5,45 A 45,45 0 0,1 -31.82,31.82" class="segment" />
                <path d="M -36.82,26.82 A 45,45 0 0,1 -45,0" class="segment" />
                <path d="M -45,-5 A 45,45 0 0,1 -31.82,-31.82" class="segment" />
                <path d="M -26.82,-36.82 A 45,45 0 0,1 0,-45" class="segment" />
            </g>
        </svg>
        <div>
            <h1 class="text-6xl font-bold bg-gradient-to-r from-emerald-400 via-teal-500 to-green-500 bg-clip-text text-transparent animate-pulse">
                 PLASMA HALL OF FAME 
            </h1>
            <div class="text-lg text-emerald-400 font-semibold mt-2">
                 Trillions 
            </div>
        </div>
    </div>
    <button id="musicToggle" class="bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-3 rounded-full shadow-lg hover:scale-105 transition-transform">
        🎵 Play Music
    </button>
</header>

<!-- Input Section -->
<div class="relative z-10 flex flex-col items-center justify-center px-4">
    <div class="bg-black/30 backdrop-blur-lg rounded-3xl p-8 border border-emerald-500/50 shadow-2xl max-w-md w-full">
        <input type="text" id="usernameInput" placeholder="your_twitter_username" class="w-full pl-3 py-3 mb-4 rounded-xl text-white bg-gray-900/80 focus:outline-none border border-emerald-500/30">
        <button id="submitBtn" class="w-full bg-gradient-to-r from-emerald-500 via-teal-500 to-green-500 py-3 rounded-xl font-bold hover:scale-105 transition-transform">🚀 Join the Wall</button>
        <div id="connectionStatus" class="mt-4 text-center text-yellow-400">🔄 Checking connection...</div>
    </div>
</div>

<!-- Hall of Fame -->
<div class="relative z-10 px-4 pb-8">
    <h3 class="text-2xl text-emerald-300 font-bold text-center mb-4">🌟 Hall of Fame 🌟</h3>
    <p id="userCount" class="text-gray-400 text-center mb-4">Loading legends...</p>
    <div id="hallOfFame" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-w-6xl mx-auto"></div>
</div>

<!-- Styles -->
<style>
.plasma-bg {
    background: linear-gradient(45deg, #047857, #0d9488, #059669, #10b981, #34d399);
    background-size: 400% 400%;
    animation: plasmaMove 12s ease-in-out infinite;
    opacity: 0.4;
}

@keyframes plasmaMove {
    0%,100% { background-position:0% 50%; }
    25% { background-position:100% 100%; }
    50% { background-position:100% 0%; }
    75% { background-position:0% 100%; }
}

.loading-spinner {
    width: 300px;
    height: 300px;
    position: relative;
}

.loading-spinner::before {
    content: '';
    position: absolute;
    inset: 0;
    background: conic-gradient(
        from 0deg,
        #ffffff 0deg,
        #ffffff 15deg,
        transparent 15deg,
        transparent 30deg,
        #ffffff 30deg,
        #ffffff 45deg,
        transparent 45deg,
        transparent 60deg,
        #ffffff 60deg,
        #ffffff 75deg,
        transparent 75deg,
        transparent 90deg,
        #ffffff 90deg,
        #ffffff 105deg,
        transparent 105deg,
        transparent 120deg,
        #ffffff 120deg,
        #ffffff 135deg,
        transparent 135deg,
        transparent 150deg,
        #ffffff 150deg,
        #ffffff 165deg,
        transparent 165deg,
        transparent 180deg,
        #ffffff 180deg,
        #ffffff 195deg,
        transparent 195deg,
        transparent 210deg,
        #ffffff 210deg,
        #ffffff 225deg,
        transparent 225deg,
        transparent 240deg,
        #ffffff 240deg,
        #ffffff 255deg,
        transparent 255deg,
        transparent 270deg,
        #ffffff 270deg,
        #ffffff 285deg,
        transparent 285deg,
        transparent 300deg,
        #ffffff 300deg,
        #ffffff 315deg,
        transparent 315deg,
        transparent 330deg,
        #ffffff 330deg,
        #ffffff 345deg,
        transparent 345deg,
        transparent 360deg
    );
    border-radius: 50%;
    animation: spinLoader 4s linear infinite;
    opacity: 0.8;
}

.loading-spinner::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120px;
    height: 120px;
    background: #064e3b;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
}

@keyframes spinLoader {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.stars {
    background-image: 
        radial-gradient(2px 2px at 20px 30px, #34d399, transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(52, 211, 153, 0.8), transparent),
        radial-gradient(1px 1px at 90px 40px, #10b981, transparent);
    background-repeat: repeat;
    background-size: 200px 100px;
    animation: sparkle 20s linear infinite;
    opacity: 0.3;
}

@keyframes sparkle {
    from { transform: translateX(0); }
    to { transform: translateX(-200px); }
}

.user-card {
    transition: all 0.3s ease;
    animation: slideUp 0.8s ease-out;
}

.user-card:hover { 
    transform: translateY(-8px) scale(1.05); 
    box-shadow: 0 25px 50px rgba(16, 185, 129, 0.4);
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(40px) scale(0.8); } 
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.pulse-ring {
    animation: pulseRing 2s infinite;
}

@keyframes pulseRing {
    0% { transform: scale(1); opacity: 1; } 
    50% { transform: scale(1.15); opacity: 0.7; } 
    100% { transform: scale(1); opacity: 1; }
}

.glow-effect {
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); 
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from { box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); } 
    to { box-shadow: 0 0 30px rgba(52, 211, 153, 0.8); }
}
</style>

<!-- Script -->
<script>
// API endpoints
const VPS_DIRECT = 'http://162.250.191.81:4000';
const API_GET = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('http://162.250.191.81:4000');

// DOM elements
const usernameInput = document.getElementById('usernameInput');
const submitBtn = document.getElementById('submitBtn');
const hallOfFame = document.getElementById('hallOfFame');
const bgMusic = document.getElementById('bgMusic');
const musicToggle = document.getElementById('musicToggle');
const connectionStatus = document.getElementById('connectionStatus');
const userCount = document.getElementById('userCount');

let musicPlaying = false;

// Music toggle
musicToggle.addEventListener('click', async () => {
    try {
        if (musicPlaying) { 
            bgMusic.pause(); 
            musicToggle.innerHTML='🎵 Play Music'; 
            musicPlaying=false; 
        }
        else { 
            await bgMusic.play(); 
            musicToggle.innerHTML='🔇 Pause Music'; 
            musicPlaying=true; 
        }
    } catch(e){ 
        console.log('Audio error:', e);
    }
});

// Default users to show if server is unavailable
const defaultUsers = [
    'elonmusk', 'sundarpichai', 'satyanadella', 'tim_cook', 
    'jeffbezos', 'billgates', 'naval', 'lexfridman'
];

// Twitter profile pictures
const twitterAvatars = {
    'elonmusk': 'https://pbs.twimg.com/profile_images/1683325380441128960/yRsRRjGO_400x400.jpg',
    'sundarpichai': 'https://pbs.twimg.com/profile_images/864282616597405701/M-FEJM-z_400x400.jpg',
    'satyanadella': 'https://pbs.twimg.com/profile_images/1221837516816306177/_Ld4un5A_400x400.jpg',
    'jeffbezos': 'https://pbs.twimg.com/profile_images/1591558315254890500/ETIHb4Nl_400x400.jpg',
    'tim_cook': 'https://pbs.twimg.com/profile_images/1535420431766671360/Pwq-1eJc_400x400.jpg',
    'billgates': 'https://pbs.twimg.com/profile_images/1414439092373254147/JdS8yLGI_400x400.jpg',
    'naval': 'https://pbs.twimg.com/profile_images/1296275068927275008/_sG_zhPj_400x400.jpg',
    'lexfridman': 'https://pbs.twimg.com/profile_images/1449365282775584769/Ls06kB_z_400x400.jpg'
};

// Check VPS connection
async function checkConnection(){
    try {
        console.log('Checking connection...');
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
        
        const res = await fetch(`${API_GET}/`, {
            method: 'GET',
            signal: controller.signal,
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        clearTimeout(timeoutId);
        
        if(res.ok){ 
            const data = await res.json();
            console.log('Connection successful:', data);
            connectionStatus.innerHTML='<span class="text-green-400">✅ Connected to Server</span>'; 
            return true;
        } else {
            throw new Error(`Server responded with ${res.status}`);
        }
    } catch(e){ 
        console.error('Connection failed:', e);
        connectionStatus.innerHTML=`<span class="text-red-400">❌ Server Offline - Showing Defaults</span>`; 
        return false;
    }
}

// Add user card with avatar
function addUserCard(username, animate=true){
    console.log('Adding user card for:', username);
    
    const card = document.createElement('div');
    card.className = `user-card bg-gradient-to-br from-emerald-600/30 to-teal-600/30 backdrop-blur-sm rounded-2xl p-4 border border-emerald-500/40 text-center ${animate ? 'pulse-ring' : ''}`;
    
    // Try hardcoded avatar first, then fallback to generated
    const avatarUrl = twitterAvatars[username.toLowerCase()] || `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`;
    
    card.innerHTML = `
        <div class="avatar-container mb-3 relative">
            <img src="${avatarUrl}" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" 
                 class="w-16 h-16 rounded-full mx-auto border-2 border-emerald-400 shadow-xl">
            <div style="display:none;" class="w-16 h-16 rounded-full mx-auto border-2 border-emerald-400 shadow-xl bg-gradient-to-r from-emerald-500 to-teal-500 flex items-center justify-center text-2xl font-bold">
                ${username.charAt(0).toUpperCase()}
            </div>
        </div>
        <h3 class="font-bold text-white">@${username}</h3>
        <div class="text-xs text-emerald-300 mt-1">Digital Legend</div>
    `;
    
    hallOfFame.appendChild(card);
}

// Show default users
function showDefaultUsers() {
    console.log('Showing default users');
    hallOfFame.innerHTML = '';
    defaultUsers.forEach((username, i) => {
        setTimeout(() => addUserCard(username, true), i * 100);
    });
    userCount.textContent = `${defaultUsers.length} digital legends (defaults)`;
}

// Load users from server
async function loadUsers(){
    console.log('Loading users from server...');
    try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second timeout
        
        const res = await fetch(`${API_GET}/users`, {
            signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        if(res.ok){
            const users = await res.json();
            console.log('Loaded users:', users);
            
            hallOfFame.innerHTML = '';
            
            if(users.length === 0) { 
                console.log('No users found, showing defaults');
                showDefaultUsers();
                return; 
            }
            
            // Show server users
            users.forEach((username, i) => {
                setTimeout(() => addUserCard(username, true), i * 100);
            });
            userCount.textContent = `${users.length} digital legends`;
        } else {
            throw new Error(`Failed to load users: ${res.status}`);
        }
    } catch(e){ 
        console.error('Failed to load users:', e);
        showDefaultUsers();
    }
}

// Save user to server
async function saveUser(username){
    console.log('Saving user:', username);
    try {
        const res = await fetch(`${VPS_DIRECT}/users`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username: username })
        });
        
        if (res.ok) {
            const result = await res.json();
            console.log('User saved successfully:', result);
            return result;
        } else {
            throw new Error(`Failed to save user: ${res.status}`);
        }
    } catch(e){ 
        console.error('Error saving user:', e);
        // Add user locally even if server save fails
        addUserCard(username, true);
        return null;
    }
}

// Submit handler
submitBtn.addEventListener('click', async () => {
    const username = usernameInput.value.trim().replace('@','');
    if(!username){ 
        alert('Please enter a username'); 
        return;
    }
    
    submitBtn.disabled = true; 
    submitBtn.textContent = 'Joining...';
    
    console.log('Submitting username:', username);
    
    try {
        await saveUser(username);
        await loadUsers(); // Reload to show the new user
        usernameInput.value = '';
        connectionStatus.innerHTML = '<span class="text-green-400">✅ User Added Successfully!</span>';
        setTimeout(() => {
            connectionStatus.innerHTML = '<span class="text-green-400">✅ Connected to Server</span>';
        }, 2000);
    } catch (e) {
        console.error('Submit error:', e);
        connectionStatus.innerHTML = '<span class="text-red-400">❌ Failed to Add User</span>';
    }
    
    submitBtn.disabled = false; 
    submitBtn.textContent = '🚀 Join the Wall';
});

// Enter key support
usernameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !submitBtn.disabled) {
        submitBtn.click();
    }
});

// Initialize app
async function init(){
    console.log('Initializing app...');
    
    // Always show default users first for immediate feedback
    showDefaultUsers();
    
    // Check server connection
    const connected = await checkConnection();
    
    // If connected, try to load server users
    if (connected) {
        await loadUsers();
    }
    
    // Set music volume
    bgMusic.volume = 0.3;
    
    console.log('App initialized');
}

// Start the app
init();
</script>

</body>
</html>
