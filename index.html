<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Plasma Wall - Enhanced</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen text-white overflow-hidden relative" style="background: linear-gradient(135deg, #1a3b2e, #0f2922, #1a3b2e); font-family: 'Space Grotesk', sans-serif;">

<div class="absolute inset-0 overflow-hidden">
    <div class="stars-far absolute inset-0"></div>
    <div class="stars-mid absolute inset-0"></div>
    <div class="stars-near absolute inset-0"></div>
    <div class="spinning-portal absolute inset-0 flex items-center justify-center">
        <div class="interstellar-ring"></div>
    </div>
    <div class="space-particles absolute inset-0"></div>
    <div class="cosmic-dust absolute inset-0"></div>
    <div class="nebula-effect absolute inset-0"></div>
</div>

<audio id="bgMusic" loop preload="auto" style="display: none;"><source src="./music.mp3" type="audio/mpeg"></audio>

<header class="relative z-10 text-center py-6">
    <h1 class="text-5xl font-bold text-white mb-4 glow-text animate-title-breath">Join the Plasma Wall</h1>
    <p class="text-green-300 text-lg">Submit your X/Twitter handle and become part of the cosmic community</p>
</header>

<div class="relative z-10 flex justify-center mb-6">
    <div class="bg-black/50 backdrop-blur-md rounded-2xl px-6 py-3 border border-green-500/30">
        <div id="userCount" class="text-green-200 font-semibold text-lg">Loading community...</div>
    </div>
</div>

<div class="relative z-10 flex flex-col items-center justify-center px-4 mb-8">
    <div class="flex flex-col md:flex-row items-center gap-4 max-w-2xl w-full">
        <input type="text" id="usernameInput" placeholder="@yourusername" class="flex-1 w-full md:w-auto px-6 py-4 rounded-full text-gray-900 bg-white/95 focus:outline-none focus:ring-4 focus:ring-green-400/50 text-lg shadow-2xl transition-all duration-300">
        <button id="submitBtn" class="px-8 py-4 w-full md:w-auto bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 rounded-full font-bold transition-all duration-300 text-lg shadow-2xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
            <span id="submitBtnText">Join Plasma</span>
            <svg id="submitSpinner" class="animate-spin h-5 w-5 text-white hidden" xmlns="http://www.w.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </button>
    </div>
    <div id="submissionStatus" class="mt-4 text-center text-lg h-6 text-green-300"></div>
    <div class="flex gap-4 mt-4">
        <button id="musicToggle" class="px-6 py-3 bg-gradient-to-r from-green-800 to-green-900 hover:from-green-900 hover:to-green-950 rounded-full font-medium transition-all duration-300 shadow-xl transform hover:scale-105">ðŸŽµ Play Music</button>
        <button id="refreshBtn" class="px-6 py-3 bg-gradient-to-r from-blue-800 to-blue-900 hover:from-blue-900 hover:to-blue-950 rounded-full font-medium transition-all duration-300 shadow-xl transform hover:scale-105">ðŸ”„ Refresh Wall</button>
    </div>
</div>

<div class="relative z-10 px-4 pb-8">
    <div class="bg-black/40 backdrop-blur-md rounded-3xl p-8 border border-green-500/30 max-w-7xl mx-auto overflow-hidden shadow-2xl">
        <div class="moving-wall-container relative h-96 overflow-hidden">
            <div id="movingWall" class="moving-wall absolute top-0 left-0 flex flex-wrap gap-4"></div>
        </div>
        <div class="flex justify-between items-center mt-6 text-sm">
            <div class="text-green-400 font-semibold">âœ¨ Built by @aabis</div>
            <div id="lastUpdated" class="text-green-400/70">Last updated: Never</div>
        </div>
    </div>
</div>

<style>
    /* Paste your amazing CSS here. I've added one new animation. */
    @keyframes titleBreath { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
    .animate-title-breath { animation: titleBreath 5s ease-in-out infinite; }
    /* All your existing CSS */
    .glow-text { text-shadow: 0 0 10px rgba(34, 197, 94, 0.5), 0 0 20px rgba(34, 197, 94, 0.3); } .stars-far { background-image: radial-gradient(1px 1px at 20px 30px, rgba(255,255,255,0.3), transparent), radial-gradient(1px 1px at 40px 70px, rgba(34, 197, 94, 0.4), transparent), radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.2), transparent), radial-gradient(1px 1px at 130px 80px, rgba(34, 197, 94, 0.3), transparent), radial-gradient(1px 1px at 160px 30px, rgba(255,255,255,0.4), transparent), radial-gradient(1px 1px at 200px 60px, rgba(34, 197, 94, 0.2), transparent), radial-gradient(1px 1px at 240px 90px, rgba(255,255,255,0.3), transparent), radial-gradient(1px 1px at 280px 10px, rgba(34, 197, 94, 0.4), transparent), radial-gradient(1px 1px at 320px 50px, rgba(255,255,255,0.2), transparent), radial-gradient(1px 1px at 360px 80px, rgba(34, 197, 94, 0.3), transparent); background-repeat: repeat; background-size: 400px 300px; animation: starsRotate 200s linear infinite; opacity: 0.6; } .stars-mid { background-image: radial-gradient(2px 2px at 60px 90px, rgba(255,255,255,0.5), transparent), radial-gradient(1px 1px at 120px 30px, rgba(34, 197, 94, 0.6), transparent), radial-gradient(2px 2px at 180px 70px, rgba(255,255,255,0.4), transparent), radial-gradient(1px 1px at 240px 100px, rgba(34, 197, 94, 0.5), transparent), radial-gradient(2px 2px at 300px 20px, rgba(255,255,255,0.6), transparent), radial-gradient(1px 1px at 360px 60px, rgba(34, 197, 94, 0.4), transparent), radial-gradient(2px 2px at 420px 110px, rgba(255,255,255,0.3), transparent), radial-gradient(1px 1px at 480px 40px, rgba(34, 197, 94, 0.7), transparent); background-repeat: repeat; background-size: 600px 400px; animation: starsRotate 150s linear infinite reverse; opacity: 0.7; } .stars-near { background-image: radial-gradient(3px 3px at 100px 50px, rgba(255,255,255,0.8), transparent), radial-gradient(2px 2px at 200px 120px, rgba(34, 197, 94, 0.9), transparent), radial-gradient(3px 3px at 300px 80px, rgba(255,255,255,0.7), transparent), radial-gradient(2px 2px at 400px 20px, rgba(34, 197, 94, 0.8), transparent), radial-gradient(4px 4px at 500px 100px, rgba(255,255,255,0.6), transparent), radial-gradient(2px 2px at 600px 60px, rgba(34, 197, 94, 0.7), transparent); background-repeat: repeat; background-size: 700px 500px; animation: starsRotate 100s linear infinite; opacity: 0.8; } @keyframes starsRotate { from { transform: rotate(0deg) translateX(0) translateY(0); } to { transform: rotate(360deg) translateX(-50px) translateY(-30px); } } .stars-near::after { content: ''; position: absolute; inset: 0; background-image: radial-gradient(2px 2px at 150px 75px, rgba(255,255,255,0.9), transparent), radial-gradient(3px 3px at 350px 125px, rgba(34, 197, 94,0.9), transparent), radial-gradient(2px 2px at 550px 25px, rgba(255,255,255,0.8), transparent); background-repeat: repeat; background-size: 700px 500px; animation: twinkle 4s ease-in-out infinite alternate; } @keyframes twinkle { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } } .nebula-effect { background: radial-gradient( ellipse at 20% 50%, rgba(34, 197, 94, 0.1) 0%, transparent 50% ), radial-gradient( ellipse at 80% 20%, rgba(16, 163, 74, 0.08) 0%, transparent 50% ), radial-gradient( ellipse at 40% 80%, rgba(21, 128, 61, 0.12) 0%, transparent 50% ); animation: nebulaFlow 60s ease-in-out infinite alternate; } @keyframes nebulaFlow { 0% { transform: scale(1) rotate(0deg); opacity: 0.3; } 50% { transform: scale(1.1) rotate(2deg); opacity: 0.5; } 100% { transform: scale(1) rotate(-1deg); opacity: 0.3; } } .spinning-portal { pointer-events: none; } .interstellar-ring { width: 500px; height: 500px; position: relative; animation: spinPortal 30s linear infinite; opacity: 0.4; } .interstellar-ring::before { content: ''; position: absolute; inset: 0; background: conic-gradient( from 0deg, transparent 0deg, #22c55e 8deg, #16a34a 15deg, transparent 25deg, transparent 35deg, #15803d 45deg, #22c55e 52deg, transparent 65deg, transparent 75deg, #16a34a 85deg, transparent 95deg, transparent 105deg, #22c55e 115deg, transparent 125deg, transparent 135deg, #15803d 145deg, #16a34a 155deg, transparent 165deg, transparent 175deg, #22c55e 185deg, transparent 195deg, transparent 205deg, #16a34a 215deg, transparent 225deg, transparent 235deg, #15803d 245deg, transparent 255deg, transparent 265deg, #22c55e 275deg, transparent 285deg, transparent 295deg, #16a34a 305deg, #15803d 315deg, transparent 325deg, transparent 335deg, #22c55e 345deg, transparent 355deg, transparent 360deg ); border-radius: 50%; mask: radial-gradient(circle, transparent 25%, black 26%, black 75%, transparent 76%); -webkit-mask: radial-gradient(circle, transparent 25%, black 26%, black 75%, transparent 76%); filter: blur(1px); } @keyframes spinPortal { from { transform: rotate(0deg); } to { transform: rotate(360deg); } } .space-particles { background-image: radial-gradient(2px 2px at 20px 30px, #22c55e, transparent), radial-gradient(1px 1px at 150px 80px, rgba(34, 197, 94, 0.8), transparent), radial-gradient(1px 1px at 300px 120px, #16a34a, transparent), radial-gradient(2px 2px at 450px 50px, rgba(21, 128, 61, 0.6), transparent), radial-gradient(1px 1px at 600px 200px, #22c55e, transparent), radial-gradient(1px 1px at 750px 100px, rgba(34, 197, 94, 0.7), transparent); background-repeat: repeat; background-size: 800px 300px, 600px 400px, 700px 350px, 500px 250px, 900px 320px, 400px 280px; animation: particleFloat 40s linear infinite; opacity: 0.8; } @keyframes particleFloat { 0% { transform: translateX(0) translateY(0) rotate(0deg); } 25% { transform: translateX(-60px) translateY(-40px) rotate(90deg); } 50% { transform: translateX(-120px) translateY(30px) rotate(180deg); } 75% { transform: translateX(-40px) translateY(-60px) rotate(270deg); } 100% { transform: translateX(0) translateY(0) rotate(360deg); } } .cosmic-dust { background-image: radial-gradient(1px 1px at 100px 100px, rgba(34, 197, 94, 0.3), transparent), radial-gradient(1px 1px at 200px 200px, rgba(16, 163, 74, 0.2), transparent), radial-gradient(1px 1px at 300px 50px, rgba(21, 128, 61, 0.4), transparent), radial-gradient(1px 1px at 400px 150px, rgba(34, 197, 94, 0.2), transparent), radial-gradient(1px 1px at 500px 250px, rgba(16, 163, 74, 0.3), transparent); background-repeat: repeat; background-size: 600px 300px, 400px 500px, 800px 200px, 300px 400px, 700px 350px; animation: dustFloat 60s linear infinite; opacity: 0.5; } @keyframes dustFloat { 0% { transform: translateX(0) translateY(0); } 33% { transform: translateX(-30px) translateY(-20px); } 66% { transform: translateX(-60px) translateY(15px); } 100% { transform: translateX(0) translateY(0); } } .moving-wall-container { mask: linear-gradient(90deg, transparent 0%, black 5%, black 95%, transparent 100%); -webkit-mask: linear-gradient(90deg, transparent 0%, black 5%, black 95%, transparent 100%); border-radius: 20px; overflow: hidden; } .moving-wall { width: max-content; animation: slideWall 80s linear infinite; display: flex; align-items: center; } @keyframes slideWall { from { transform: translateX(0); } to { transform: translateX(-50%); } } .user-card { flex-shrink: 0; width: 140px; height: 140px; position: relative; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; margin: 10px; } .user-card:hover { transform: scale(1.2) translateY(-10px) rotateZ(5deg); z-index: 10; } .profile-img { width: 100%; height: 100%; object-fit: cover; border-radius: 16px; border: 4px solid rgba(34, 197, 94, 0.9); box-shadow: 0 0 25px rgba(34, 197, 94, 0.5), 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1); transition: all 0.4s ease; } .user-card:hover .profile-img { border-color: #22c55e; box-shadow: 0 0 40px rgba(34, 197, 94, 0.8), 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2); } .username-overlay { position: absolute; bottom: -8px; left: 0; right: 0; background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.85) 100%); color: #22c55e; text-align: center; padding: 6px 4px; font-size: 12px; font-weight: bold; border-radius: 0 0 16px 16px; border: 2px solid rgba(34, 197, 94, 0.6); border-top: none; backdrop-filter: blur(10px); text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); transition: all 0.4s ease; } .user-card:hover .username-overlay { background: linear-gradient(135deg, rgba(34, 197, 94, 0.9) 0%, rgba(16, 163, 74, 0.9) 100%); color: white; border-color: #22c55e; transform: translateY(-2px); } .loading-placeholder { background: linear-gradient(90deg, rgba(31, 41, 55, 0.8) 25%, rgba(55, 65, 81, 0.9) 50%, rgba(31, 41, 55, 0.8) 75%); background-size: 200% 100%; animation: shimmer 2s infinite; border-radius: 16px; border: 4px solid rgba(34, 197, 94, 0.3); position: relative; } .loading-placeholder::after { content: 'âš¡'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; color: rgba(34, 197, 94, 0.8); animation: pulse 1.5s infinite; } @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } } @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } } .error-avatar { background: linear-gradient(135deg, #16a34a 0%, #15803d 50%, #166534 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; border-radius: 16px; border: 4px solid rgba(34, 197, 94, 0.9); box-shadow: 0 0 25px rgba(34, 197, 94, 0.5), 0 8px 32px rgba(0, 0, 0, 0.3); text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5); position: relative; overflow: hidden; } .error-avatar::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent); animation: shine 3s infinite; } @keyframes shine { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } @keyframes successPulse { 0% { transform: scale(1); box-shadow: 0 0 25px rgba(34, 197, 94, 0.5); } 50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(34, 197, 94, 0.8); } 100% { transform: scale(1); box-shadow: 0 0 25px rgba(34, 197, 94, 0.5); } } .success-added { animation: successPulse 0.6s ease-in-out; }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIGURATION ---
    // Make sure your server is running on this URL
    const SERVER_URL = 'http://localhost:4000';

    // --- DOM ELEMENTS ---
    const movingWall = document.getElementById('movingWall');
    const userCount = document.getElementById('userCount');
    const lastUpdated = document.getElementById('lastUpdated');
    const submissionStatus = document.getElementById('submissionStatus');
    const usernameInput = document.getElementById('usernameInput');
    const submitBtn = document.getElementById('submitBtn');
    const submitBtnText = document.getElementById('submitBtnText');
    const submitSpinner = document.getElementById('submitSpinner');
    const refreshBtn = document.getElementById('refreshBtn');
    const bgMusic = document.getElementById('bgMusic');
    const musicToggle = document.getElementById('musicToggle');

    let allUsers = []; // This will be filled from the server

    // --- Core Functions ---

    /**
     * Fetches the list of users from the backend server.
     */
    async function fetchUsers() {
        try {
            submissionStatus.textContent = 'Connecting to the plasma network...';
            const response = await fetch(`${SERVER_URL}/users`);
            if (!response.ok) {
                throw new Error('Network response was not ok.');
            }
            allUsers = await response.json();
            submissionStatus.textContent = 'âœ… Connection established.';
            setTimeout(() => submissionStatus.textContent = '', 3000);
            displayMovingWall();
        } catch (error) {
            console.error('âŒ Failed to fetch users:', error);
            submissionStatus.textContent = 'âš ï¸ Could not connect to server. Running in offline mode.';
            userCount.textContent = 'Community data unavailable.';
        }
    }

    /**
     * Creates a user card element. Much simpler now!
     */
    function createUserCard(user, isNew = false) {
        const card = document.createElement('a');
        card.className = 'user-card';
        card.href = `https://twitter.com/${user.username}`;
        card.target = '_blank';
        if (isNew) {
            card.classList.add('success-added');
        }

        const img = document.createElement('img');
        img.className = 'profile-img';
        img.src = user.pfpUrl; // Use the URL directly from our server!
        img.alt = user.username;
        
        // Add a fallback in case the image link from the server is broken
        img.onerror = () => {
            img.src = `https://api.dicebear.com/7.x/initials/svg?seed=${user.username}&backgroundColor=22c55e&radius=20`;
        };

        const overlay = document.createElement('div');
        overlay.className = 'username-overlay';
        overlay.textContent = `@${user.username}`;

        card.appendChild(img);
        card.appendChild(overlay);
        return card;
    }

    /**
     * Renders all users onto the moving wall.
     */
    function displayMovingWall(newUsername = null) {
        movingWall.innerHTML = '';
        if (allUsers.length === 0) {
            movingWall.innerHTML = `<div class="loading-placeholder" style="width:140px; height:140px;"></div>`.repeat(10);
            return;
        }

        const fragment = document.createDocumentFragment();
        
        // Add users to the wall
        allUsers.forEach(user => {
            const isNew = user.username === newUsername;
            fragment.appendChild(createUserCard(user, isNew));
        });

        // Duplicate for seamless animation loop
        if (allUsers.length > 5) { // Only loop if there are enough users
             allUsers.forEach(user => {
                fragment.appendChild(createUserCard(user));
            });
        }

        movingWall.appendChild(fragment);

        // Update stats
        userCount.textContent = `ðŸŒŸ ${allUsers.length} members in the Plasma Wall`;
        lastUpdated.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
    }
    
    /**
     * Submits a new user to the backend.
     */
    async function submitUser() {
        const username = usernameInput.value.trim().replace('@', '');
        if (!username || username.length < 2) {
            submissionStatus.textContent = 'Please enter a valid username.';
            return;
        }
        
        // Disable button and show spinner
        setLoadingState(true);

        try {
            const response = await fetch(`${SERVER_URL}/addUser`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username }),
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.message || 'An error occurred.');
            }

            // Success! Add the new user to our local list and re-render.
            allUsers.push(result);
            displayMovingWall(result.username);
            submissionStatus.textContent = `âœ… @${username} successfully joined the wall!`;
            usernameInput.value = '';

        } catch (error) {
            console.error('âŒ Submission failed:', error);
            submissionStatus.textContent = `âš ï¸ Error: ${error.message}`;
        } finally {
            // Re-enable button
            setLoadingState(false);
            setTimeout(() => submissionStatus.textContent = '', 4000);
        }
    }

    // --- UI Helpers & Event Listeners ---
    
    function setLoadingState(isLoading) {
        if (isLoading) {
            submitBtn.disabled = true;
            submitBtnText.textContent = 'Joining...';
            submitSpinner.classList.remove('hidden');
        } else {
            submitBtn.disabled = false;
            submitBtnText.textContent = 'Join Plasma';
            submitSpinner.classList.add('hidden');
        }
    }
    
    submitBtn.addEventListener('click', submitUser);
    usernameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') submitUser();
    });

    refreshBtn.addEventListener('click', fetchUsers);
    
    let isMusicPlaying = false;
    musicToggle.addEventListener('click', () => {
        if (isMusicPlaying) {
            bgMusic.pause();
            musicToggle.textContent = 'ðŸŽµ Play Music';
        } else {
            bgMusic.volume = 0.3;
            bgMusic.play().catch(e => console.error("Audio play failed:", e));
            musicToggle.textContent = 'ðŸ”‡ Pause Music';
        }
        isMusicPlaying = !isMusicPlaying;
    });

    // --- Initial Load ---
    function init() {
        console.log('ðŸš€ Initializing Plasma Wall...');
        fetchUsers();
    }

    init();
});
</script>
</body>
</html>
