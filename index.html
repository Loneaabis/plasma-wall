<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plasma Hall of Fame</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-black to-gray-900 text-white flex flex-col items-center py-10">

  <!-- Music Controls -->
  <div class="fixed top-4 right-4 z-10">
    <button id="musicToggle" onclick="toggleMusic()" 
      class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg shadow-lg transition">
      ðŸŽµ Play Music
    </button>
    <audio id="backgroundMusic" loop>
      <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mp3">
    </audio>
  </div>

  <!-- Header -->
  <div class="flex flex-col items-center mb-8">
    <!-- Plasma Logo -->
    <div class="w-24 h-24 mb-4 flex items-center justify-center">
      <div class="w-24 h-24 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-2xl font-bold shadow-xl">
        P
      </div>
    </div>
    <h1 class="text-4xl font-extrabold tracking-wide text-purple-300">Plasma Hall of Fame</h1>
    <p class="text-gray-400 mt-2">Join the Plasma family - Submit your Twitter username!</p>
  </div>

  <!-- Connection Status -->
  <div id="connectionStatus" class="mb-4 px-4 py-2 rounded-lg text-sm font-semibold">
    ðŸ”„ Checking connection...
  </div>

  <!-- Input Form -->
  <div class="bg-gray-800/70 p-6 rounded-xl shadow-lg w-96 mb-8">
    <input id="usernameInput" type="text" placeholder="Enter Twitter username (without @)"
      class="w-full px-3 py-2 mb-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" />
    <button onclick="addToWall()"
      class="w-full bg-purple-600 hover:bg-purple-700 transition px-4 py-2 rounded-lg font-semibold shadow">
      ðŸš€ Join Plasma Wall
    </button>
  </div>

  <!-- Stats -->
  <div class="mb-6 text-center">
    <p class="text-purple-300 font-semibold">
      <span id="memberCount">0</span> Plasma Family Members
    </p>
    <button onclick="refreshWall()" class="mt-2 text-sm text-gray-400 hover:text-white transition">
      ðŸ”„ Refresh Wall
    </button>
  </div>

  <!-- Wall -->
  <div id="wall" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 w-11/12 max-w-6xl"></div>

  <script>
    // Your VPS Backend URL
    const API_BASE_URL = 'http://162.250.191.81:4000';
    
    let musicPlaying = false;
    let isConnected = false;

    // Load when page opens
    document.addEventListener('DOMContentLoaded', function() {
      checkConnection();
      loadMembers();
    });

    // Check if backend is working
    async function checkConnection() {
      const statusDiv = document.getElementById('connectionStatus');
      
      try {
        const response = await fetch(`${API_BASE_URL}/`);
        
        if (response.ok) {
          statusDiv.textContent = 'âœ… Connected to backend';
          statusDiv.className = 'mb-4 px-4 py-2 rounded-lg text-sm font-semibold bg-green-600/30 text-green-300';
          isConnected = true;
        }
      } catch (error) {
        console.error('Connection failed:', error);
        statusDiv.textContent = 'âŒ Backend offline';
        statusDiv.className = 'mb-4 px-4 py-2 rounded-lg text-sm font-semibold bg-red-600/30 text-red-300';
        isConnected = false;
      }
    }

    // Toggle music
    function toggleMusic() {
      const music = document.getElementById('backgroundMusic');
      const button = document.getElementById('musicToggle');
      
      if (musicPlaying) {
        music.pause();
        button.textContent = 'ðŸŽµ Play Music';
        musicPlaying = false;
      } else {
        music.play().catch(e => console.log('Click to enable audio'));
        button.textContent = 'ðŸŽµ Pause Music';
        musicPlaying = true;
      }
    }

    // Add user to wall
    async function addToWall() {
      const username = document.getElementById("usernameInput").value.trim();
      
      if (!username) {
        alert('Please enter a Twitter username');
        return;
      }
      
      const cleanUsername = username.replace('@', '');
      
      if (isConnected) {
        try {
          const response = await fetch(`${API_BASE_URL}/users`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: cleanUsername })
          });
          
          if (response.ok) {
            console.log('User saved!');
            await loadMembers();
          }
        } catch (error) {
          console.error('Error saving:', error);
        }
      }
      
      document.getElementById("usernameInput").value = "";
    }

    // Load all users from backend
    async function loadMembers() {
      if (!isConnected) return;
      
      try {
        const response = await fetch(`${API_BASE_URL}/users`);
        const users = await response.json();
        
        console.log('Loaded users:', users);
        
        // Clear wall
        const wall = document.getElementById('wall');
        wall.innerHTML = '';
        
        // Add each user
        users.forEach(username => {
          addMemberToWall(username);
        });
        
        updateMemberCount();
      } catch (error) {
        console.error('Failed to load members:', error);
      }
    }

    // Add member card to wall
    function addMemberToWall(username) {
      const wall = document.getElementById("wall");
      
      const card = document.createElement("div");
      card.className = "p-4 bg-gray-900/80 rounded-2xl shadow-lg hover:scale-105 transition-all duration-300";

      card.innerHTML = `
        <a href="https://twitter.com/${username}" target="_blank" class="block text-center group">
          <div class="relative">
            <img src="https://unavatar.io/twitter/${username}" 
                 alt="${username}" 
                 class="w-20 h-20 rounded-full mx-auto mb-3 border-2 border-purple-500 shadow-md transition-all group-hover:border-purple-400"
                 onerror="this.src='https://ui-avatars.com/api/?name=${username}&background=9333ea&color=fff&size=80'">
            <div class="absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
              <span class="text-white text-xs">âœ“</span>
            </div>
          </div>
          <p class="font-semibold text-purple-300 break-words group-hover:text-purple-200 transition-colors">@${username}</p>
        </a>
      `;

      wall.appendChild(card);
    }

    // Refresh the wall
    function refreshWall() {
      if (isConnected) {
        loadMembers();
      } else {
        checkConnection();
      }
    }

    // Update member count
    function updateMemberCount() {
      const count = document.getElementById('wall').children.length;
      document.getElementById('memberCount').textContent = count;
    }

    // Enter key support
    document.getElementById('usernameInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        addToWall();
      }
    });
  </script>

</body>
</html>
