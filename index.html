<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plasma Hall of Fame</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-black to-gray-900 text-white flex flex-col items-center py-10">

  <!-- Header -->
  <div class="flex flex-col items-center mb-8">
    <!-- If plasma.png is uploaded correctly it will show. If not, we show fallback text. -->
    <img id="logoImg" src="plasma.png" alt="Plasma Logo" class="w-24 mb-4 drop-shadow-lg" />
    <div id="logoFallback" class="w-24 mb-4 text-center font-extrabold text-2xl text-purple-300 hidden">Plasma</div>

    <h1 class="text-4xl font-extrabold tracking-wide text-purple-300">Plasma Hall of Fame</h1>
    <p class="text-gray-400 mt-2">Celebrate the early builders of PlasmaChain</p>
  </div>

  <!-- Input Form -->
  <div class="bg-gray-800/70 p-6 rounded-xl shadow-lg w-96 mb-8">
    <form id="joinForm" class="space-y-3" onsubmit="return false;">
      <input id="usernameInput" type="text" placeholder="Enter Twitter username (no @)"
        class="w-full px-3 py-2 text-black rounded-lg focus:outline-none" autocomplete="off" />
      <button id="joinBtn" type="button"
        class="w-full bg-purple-600 hover:bg-purple-700 transition px-4 py-2 rounded-lg font-semibold shadow">
        Join the Wall
      </button>
    </form>
    <p id="hint" class="text-xs text-gray-400 mt-2">Tip: type the username without the leading @ (e.g. <code>jack</code>).</p>
  </div>

  <!-- Wall -->
  <div id="wall" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6 w-11/12 max-w-5xl mb-8"></div>

  <!-- Music controls -->
  <div class="mt-8 text-center">
    <audio id="bgMusic" loop preload="none">
      <source src="interstellar.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>

    <div id="musicControls" class="flex flex-col items-center">
      <button id="musicBtn"
        class="mt-3 bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg shadow font-semibold">
        ▶ Play Interstellar
      </button>
      <p id="musicStatus" class="text-sm text-gray-400 mt-2 hidden"></p>
    </div>
  </div>

  <script>
    /* ---------- Helpers ---------- */
    function sanitizeUsername(raw) {
      if (!raw) return "";
      // remove leading/trailing spaces and any leading @ signs
      return raw.trim().replace(/^@+/, "");
    }

    // Build a simple SVG avatar (data URI) using first letter
    function svgAvatarDataUrl(username) {
      const letter = (username && username[0]) ? username[0].toUpperCase() : "P";
      const bg = "#2d0236"; // dark purple
      const fg = "#e9d5ff"; // light
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='400' height='400'>
        <rect width='100%' height='100%' fill='${bg}' rx='60' />
        <text x='50%' y='52%' font-family='Arial, Helvetica, sans-serif' font-size='180' fill='${fg}' dominant-baseline='middle' text-anchor='middle'>${letter}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    /* ---------- DOM References ---------- */
    const wall = document.getElementById('wall');
    const input = document.getElementById('usernameInput');
    const joinBtn = document.getElementById('joinBtn');
    const musicBtn = document.getElementById('musicBtn');
    const music = document.getElementById('bgMusic');
    const musicStatus = document.getElementById('musicStatus');
    const logoImg = document.getElementById('logoImg');
    const logoFallback = document.getElementById('logoFallback');

    /* ---------- Logo fallback ---------- */
    logoImg.onerror = () => {
      // hide broken image and show text fallback
      logoImg.style.display = 'none';
      logoFallback.style.display = 'block';
      console.warn('plasma.png not found. Upload plasma.png to repo root.');
    };
    // if image loads, hide fallback
    logoImg.onload = () => {
      logoFallback.style.display = 'none';
      logoImg.style.display = 'block';
    };

    /* ---------- Music ---------- */
    function updateMusicButton() {
      musicBtn.textContent = music.paused ? '▶ Play Interstellar' : '⏸ Pause Interstellar';
    }
    musicBtn.addEventListener('click', async () => {
      try {
        if (music.paused) {
          await music.play();
          updateMusicButton();
          musicStatus.classList.add('hidden');
        } else {
          music.pause();
          updateMusicButton();
        }
      } catch (err) {
        // playback prevented or file missing
        musicStatus.textContent = 'Cannot play music. Make sure interstellar.mp3 is uploaded, and click the button to allow sound.';
        musicStatus.classList.remove('hidden');
        console.error(err);
      }
    });
    music.onerror = () => {
      musicStatus.textContent = 'interstellar.mp3 not found. Upload interstellar.mp3 to the repo root.';
      musicStatus.classList.remove('hidden');
    };

    /* ---------- Wall persistence ---------- */
    function loadSavedUsers() {
      try {
        const saved = JSON.parse(localStorage.getItem('plasmaWall')) || [];
        return Array.isArray(saved) ? saved : [];
      } catch (e) {
        return [];
      }
    }

    function saveUsers(arr) {
      localStorage.setItem('plasmaWall', JSON.stringify(arr));
    }

    // Prevent duplicates
    function isAlreadyAdded(username) {
      return !!document.querySelector(`[data-username="${CSS.escape(username)}"]`);
    }

    /* ---------- Add card ---------- */
    function addCard(rawUsername, save = true) {
      const username = sanitizeUsername(rawUsername);
      if (!username) return;
      if (isAlreadyAdded(username)) return;

      const card = document.createElement('div');
      card.className = 'p-4 bg-gray-900/80 rounded-2xl shadow-lg hover:scale-105 transition flex flex-col items-center';
      card.setAttribute('data-username', username);

      const link = document.createElement('a');
      link.href = `https://twitter.com/${username}`;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.className = 'block text-center';

      const avatar = document.createElement('img');
      avatar.className = 'w-20 h-20 rounded-full mx-auto mb-3 border-2 border-purple-500 shadow-md object-cover';
      // Primary: unavatar service
      avatar.src = `https://unavatar.io/twitter/${encodeURIComponent(username)}`;

      // If avatar fails, use generated SVG data URL
      avatar.onerror = () => {
        avatar.src = svgAvatarDataUrl(username);
        avatar.onerror = null; // avoid loop
      };

      const p = document.createElement('p');
      p.className = 'font-semibold text-purple-300';
      p.textContent = `@${username}`;

      link.appendChild(avatar);
      link.appendChild(p);
      card.appendChild(link);
      wall.appendChild(card);

      if (save) {
        const saved = loadSavedUsers();
        if (!saved.includes(username)) {
          saved.push(username);
          saveUsers(saved);
        }
      }
    }

    /* ---------- Load existing on page load ---------- */
    window.addEventListener('load', () => {
      const savedUsers = loadSavedUsers();
      savedUsers.forEach(u => addCard(u, false));
      updateMusicButton();
    });

    /* ---------- Hook up Join button and Enter key ---------- */
    joinBtn.addEventListener('click', () => {
      const u = sanitizeUsername(input.value);
      if (!u) return;
      addCard(u, true);
      input.value = '';
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        joinBtn.click();
      }
    });
  </script>

</body>
</html>
