<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Plasma Hall of Fame</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-emerald-900 via-teal-900 to-green-900 text-white overflow-hidden relative">

<!-- Background Animations -->
<div class="absolute inset-0 overflow-hidden">
    <div class="plasma-bg absolute inset-0"></div>
    <div class="spinning-circle absolute inset-0 flex items-center justify-center">
        <div class="loading-spinner"></div>
    </div>
    <div class="stars absolute inset-0"></div>
</div>

<!-- Audio -->
<audio id="bgMusic" loop preload="auto">
    <source src="./interstellar.mp3" type="audio/mpeg">
</audio>

<!-- Header -->
<header class="relative z-10 text-center py-8">
    <h1 class="text-6xl font-bold bg-gradient-to-r from-emerald-400 via-teal-500 to-green-500 bg-clip-text text-transparent mb-4 animate-pulse">
        âš¡ PLASMA HALL OF FAME âš¡
    </h1>
    <button id="musicToggle" class="bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-3 rounded-full shadow-lg hover:scale-105 transition-transform">
        ğŸµ Play Music
    </button>
</header>

<!-- Input Section -->
<div class="relative z-10 flex flex-col items-center justify-center px-4">
    <div class="bg-black/30 backdrop-blur-lg rounded-3xl p-8 border border-emerald-500/50 shadow-2xl max-w-md w-full">
        <input type="text" id="usernameInput" placeholder="your_twitter_username" class="w-full pl-3 py-3 mb-4 rounded-xl text-white bg-gray-900/80 focus:outline-none border border-emerald-500/30">
        <button id="submitBtn" class="w-full bg-gradient-to-r from-emerald-500 via-teal-500 to-green-500 py-3 rounded-xl font-bold hover:scale-105 transition-transform">ğŸš€ Join the Wall</button>
        <div id="connectionStatus" class="mt-4 text-center text-yellow-400">ğŸ”„ Checking connection...</div>
    </div>
</div>

<!-- Hall of Fame -->
<div class="relative z-10 px-4 pb-8">
    <h3 class="text-2xl text-emerald-300 font-bold text-center mb-4">ğŸŒŸ Hall of Fame ğŸŒŸ</h3>
    <p id="userCount" class="text-gray-400 text-center mb-4">Loading legends...</p>
    <div id="hallOfFame" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-w-6xl mx-auto"></div>
</div>

<!-- Styles -->
<style>
.plasma-bg {
    background: linear-gradient(45deg, #047857, #0d9488, #059669, #10b981, #34d399);
    background-size: 400% 400%;
    animation: plasmaMove 12s ease-in-out infinite;
    opacity: 0.4;
}

@keyframes plasmaMove {
    0%,100% { background-position:0% 50%; }
    25% { background-position:100% 100%; }
    50% { background-position:100% 0%; }
    75% { background-position:0% 100%; }
}

.loading-spinner {
    width: 300px;
    height: 300px;
    position: relative;
}

.loading-spinner::before {
    content: '';
    position: absolute;
    inset: 0;
    background: conic-gradient(
        from 0deg,
        transparent 0deg,
        transparent 10deg,
        white 10deg,
        white 15deg,
        transparent 15deg,
        transparent 25deg,
        white 25deg,
        white 30deg,
        transparent 30deg,
        transparent 40deg,
        white 40deg,
        white 45deg,
        transparent 45deg,
        transparent 55deg,
        white 55deg,
        white 60deg,
        transparent 60deg,
        transparent 70deg,
        white 70deg,
        white 75deg,
        transparent 75deg,
        transparent 85deg,
        white 85deg,
        white 90deg,
        transparent 90deg,
        transparent 100deg,
        white 100deg,
        white 105deg,
        transparent 105deg,
        transparent 115deg,
        white 115deg,
        white 120deg,
        transparent 120deg,
        transparent 130deg,
        white 130deg,
        white 135deg,
        transparent 135deg,
        transparent 145deg,
        white 145deg,
        white 150deg,
        transparent 150deg,
        transparent 160deg,
        white 160deg,
        white 165deg,
        transparent 165deg,
        transparent 175deg,
        white 175deg,
        white 180deg,
        transparent 180deg,
        transparent 190deg,
        white 190deg,
        white 195deg,
        transparent 195deg,
        transparent 205deg,
        white 205deg,
        white 210deg,
        transparent 210deg,
        transparent 220deg,
        white 220deg,
        white 225deg,
        transparent 225deg,
        transparent 235deg,
        white 235deg,
        white 240deg,
        transparent 240deg,
        transparent 250deg,
        white 250deg,
        white 255deg,
        transparent 255deg,
        transparent 265deg,
        white 265deg,
        white 270deg,
        transparent 270deg,
        transparent 280deg,
        white 280deg,
        white 285deg,
        transparent 285deg,
        transparent 295deg,
        white 295deg,
        white 300deg,
        transparent 300deg,
        transparent 310deg,
        white 310deg,
        white 315deg,
        transparent 315deg,
        transparent 325deg,
        white 325deg,
        white 330deg,
        transparent 330deg,
        transparent 340deg,
        white 340deg,
        white 345deg,
        transparent 345deg,
        transparent 355deg,
        white 355deg,
        white 360deg
    );
    border-radius: 50%;
    animation: spinLoader 4s linear infinite;
    opacity: 0.8;
}

.loading-spinner::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120px;
    height: 120px;
    background: radial-gradient(circle, #064e3b, #065f46);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
}

@keyframes spinLoader {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.stars {
    background-image: 
        radial-gradient(2px 2px at 20px 30px, #34d399, transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(52, 211, 153, 0.8), transparent),
        radial-gradient(1px 1px at 90px 40px, #10b981, transparent);
    background-repeat: repeat;
    background-size: 200px 100px;
    animation: sparkle 20s linear infinite;
    opacity: 0.3;
}

@keyframes sparkle {
    from { transform: translateX(0); }
    to { transform: translateX(-200px); }
}

.user-card {
    transition: all 0.3s ease;
    animation: slideUp 0.8s ease-out;
}

.user-card:hover { 
    transform: translateY(-8px) scale(1.05); 
    box-shadow: 0 25px 50px rgba(16, 185, 129, 0.4);
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(40px) scale(0.8); } 
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.pulse-ring {
    animation: pulseRing 2s infinite;
}

@keyframes pulseRing {
    0% { transform: scale(1); opacity: 1; } 
    50% { transform: scale(1.15); opacity: 0.7; } 
    100% { transform: scale(1); opacity: 1; }
}

.glow-effect {
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); 
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from { box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); } 
    to { box-shadow: 0 0 30px rgba(52, 211, 153, 0.8); }
}
</style>

<!-- Script -->
<script>
// Use direct API for POST, CORS proxy only for GET
const VPS_DIRECT = 'http://162.250.191.81:4000';
const API_GET = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('http://162.250.191.81:4000');
const usernameInput = document.getElementById('usernameInput');
const submitBtn = document.getElementById('submitBtn');
const hallOfFame = document.getElementById('hallOfFame');
const bgMusic = document.getElementById('bgMusic');
const musicToggle = document.getElementById('musicToggle');
const connectionStatus = document.getElementById('connectionStatus');
const userCount = document.getElementById('userCount');

let musicPlaying = false;

// Music toggle
musicToggle.addEventListener('click', async () => {
    try {
        if (musicPlaying) { 
            bgMusic.pause(); 
            musicToggle.innerHTML='ğŸµ Play Music'; 
            musicPlaying=false; 
        }
        else { 
            await bgMusic.play(); 
            musicToggle.innerHTML='ğŸ”‡ Pause Music'; 
            musicPlaying=true; 
        }
    } catch(e){ 
        console.log(e);
    }
});

// Check VPS connection
async function checkConnection(){
    try {
        console.log('Trying to connect to:', `${API_GET}/`);
        
        const res = await fetch(`${API_GET}/`, {
            method: 'GET',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        console.log('Response status:', res.status);
        if(res.ok){ 
            const data = await res.json();
            console.log('Response data:', data);
            connectionStatus.innerHTML='<span class="text-green-400">âœ… Connected</span>'; 
            return true;
        }
        else throw new Error(`Server responded with ${res.status}`);
    } catch(e){ 
        console.error('Connection error details:', e);
        connectionStatus.innerHTML=`<span class="text-red-400">âŒ Server unavailable</span>`; 
        return false;
    }
}

// Load users from server or show defaults
async function loadUsers(){
    try {
        const res = await fetch(`${API_GET}/users`);
        if(res.ok){
            const users = await res.json();
            hallOfFame.innerHTML='';
            if(users.length===0) { 
                // Show default users if no users in database
                addDefaultUsers();
                return; 
            }
            users.forEach((u,i)=>setTimeout(()=>addUserCard(u,true),i*100));
            userCount.textContent=`${users.length} digital legends`;
        }
    } catch(e){ 
        console.log(e);
        // Show default users if connection fails
        hallOfFame.innerHTML='';
        addDefaultUsers();
    }
}

// Save user - use direct VPS connection to avoid CORS proxy issues with POST
async function saveUser(username){
    try {
        const res = await fetch(`${VPS_DIRECT}/users`,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({username})
        });
        return await res.json();
    } catch(e){ 
        console.log(e);
    }
}

// Add user card with hardcoded Twitter profiles for better reliability
function addUserCard(username, animate=true){
    // Hardcoded Twitter profile pictures for popular usernames
    const twitterAvatars = {
        'elonmusk': 'https://pbs.twimg.com/profile_images/1683325380441128960/yRsRRjGO_400x400.jpg',
        'sundarpichai': 'https://pbs.twimg.com/profile_images/864282616597405701/M-FEJMØ²_400x400.jpg',
        'satyanadella': 'https://pbs.twimg.com/profile_images/1221837516816306177/_Ld4un5A_400x400.jpg',
        'jeffbezos': 'https://pbs.twimg.com/profile_images/1591558315254890500/ETIHb4Nl_400x400.jpg',
        'tim_cook': 'https://pbs.twimg.com/profile_images/1535420431766671360/Pwq-1eJc_400x400.jpg',
        'billgates': 'https://pbs.twimg.com/profile_images/1414439092373254147/JdS8yLGI_400x400.jpg',
        'naval': 'https://pbs.twimg.com/profile_images/1296275068927275008/_sG_zhPj_400x400.jpg',
        'karpathy': 'https://pbs.twimg.com/profile_images/1296667294148382721/9Pr6XrPB_400x400.jpg',
        'lexfridman': 'https://pbs.twimg.com/profile_images/1449365282775584769/Ls06kB_z_400x400.jpg'
    };

    const card = document.createElement('div');
    card.className=`user-card bg-gradient-to-br from-emerald-600/30 to-teal-600/30 backdrop-blur-sm rounded-2xl p-4 border border-emerald-500/40 text-center ${animate?'pulse-ring':''}`;
    
    // Try hardcoded avatar first, then fallbacks
    const avatarSources = [
        twitterAvatars[username.toLowerCase()], // Hardcoded Twitter avatar
        `https://unavatar.io/twitter/${username}`,
        `https://github.com/${username}.png`,
        `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`
    ].filter(Boolean); // Remove undefined values
    
    let currentIndex = 0;
    const tryNextAvatar = (img) => {
        if (currentIndex < avatarSources.length - 1) {
            currentIndex++;
            img.src = avatarSources[currentIndex];
        } else {
            // Show fallback letter
            img.style.display = 'none';
            const fallback = document.createElement('div');
            fallback.className = 'w-16 h-16 rounded-full mx-auto border-2 border-emerald-400 shadow-xl bg-gradient-to-r from-emerald-500 to-teal-500 flex items-center justify-center text-2xl font-bold';
            fallback.textContent = username.charAt(0).toUpperCase();
            card.querySelector('.avatar-container').appendChild(fallback);
        }
    };
    
    card.innerHTML=`
        <div class="avatar-container mb-3 relative">
            <img src="${avatarSources[0]}" onerror="(${tryNextAvatar.toString()})(this)" class="w-16 h-16 rounded-full mx-auto border-2 border-emerald-400 shadow-xl">
        </div>
        <h3 class="font-bold text-white">@${username}</h3>
        <div class="text-xs text-emerald-300 mt-1">Digital Legend</div>
    `;
    hallOfFame.appendChild(card);
}

// Submit
submitBtn.addEventListener('click',async()=>{
    const username = usernameInput.value.trim().replace('@','');
    if(!username){ 
        alert('Enter username'); 
        return;
    }
    submitBtn.disabled=true; 
    submitBtn.textContent='Joining...';
    await saveUser(username);
    await loadUsers();
    submitBtn.disabled=false; 
    submitBtn.textContent='ğŸš€ Join the Wall';
    usernameInput.value='';
});

// Enter key support
usernameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !submitBtn.disabled) {
        submitBtn.click();
    }
});

// Init
async function init(){
    await checkConnection();
    await loadUsers();
    bgMusic.volume=0.3;
}
init();
</script>

</body>
</html>
