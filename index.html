<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Plasma Hall of Fame</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white overflow-hidden relative">

<!-- Background Animations -->
<div class="absolute inset-0 overflow-hidden">
    <div class="plasma-bg absolute inset-0"></div>
    <div class="stars absolute inset-0"></div>
</div>

<!-- Header -->
<header class="relative z-10 text-center py-8">
    <h1 class="text-6xl font-bold bg-gradient-to-r from-cyan-400 via-purple-500 to-pink-500 bg-clip-text text-transparent mb-4 animate-pulse">
        ‚ö° PLASMA HALL OF FAME ‚ö°
    </h1>
    <button id="musicToggle" class="bg-gradient-to-r from-purple-500 to-pink-500 px-6 py-3 rounded-full shadow-lg hover:scale-105 transition-transform">
        üéµ Play Music
    </button>
</header>

<!-- Input Section -->
<div class="relative z-10 flex flex-col items-center justify-center px-4">
    <div class="bg-black/30 backdrop-blur-lg rounded-3xl p-8 border border-purple-500/50 shadow-2xl max-w-md w-full">
        <input type="text" id="usernameInput" placeholder="your_twitter_username" class="w-full pl-3 py-3 mb-4 rounded-xl text-white bg-gray-900/80 focus:outline-none border border-purple-500/30">
        <button id="submitBtn" class="w-full bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 py-3 rounded-xl font-bold hover:scale-105 transition-transform">üöÄ Join the Wall</button>
        <div id="connectionStatus" class="mt-4 text-center text-yellow-400">üîÑ Checking connection...</div>
        <div id="errorMsg" class="mt-2 text-center text-red-400 hidden"></div>
    </div>
</div>

<!-- Hall of Fame -->
<div class="relative z-10 px-4 pb-8">
    <h3 class="text-2xl text-purple-300 font-bold text-center mb-4">üåü Hall of Fame üåü</h3>
    <p id="userCount" class="text-gray-400 text-center mb-4">Loading legends...</p>
    <div id="hallOfFame" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-w-6xl mx-auto"></div>
</div>

<!-- Styles -->
<style>
.plasma-bg {
    background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5, #ffbe0b);
    background-size: 400% 400%;
    animation: plasmaMove 12s ease-in-out infinite;
    opacity: 0.4;
}

@keyframes plasmaMove {
    0%,100% { background-position:0% 50%; }
    25% { background-position:100% 100%; }
    50% { background-position:100% 0%; }
    75% { background-position:0% 100%; }
}

.stars {
    background-image: 
        radial-gradient(2px 2px at 20px 30px,#eee,transparent),
        radial-gradient(2px 2px at 40px 70px,rgba(255,255,255,0.8),transparent),
        radial-gradient(1px 1px at 90px 40px,#fff,transparent);
    background-repeat: repeat;
    background-size: 200px 100px;
    animation: sparkle 20s linear infinite;
    opacity: 0.5;
}

@keyframes sparkle {
    from { transform: translateX(0); }
    to { transform: translateX(-200px); }
}

.user-card {
    transition: all 0.3s ease;
    animation: slideUp 0.8s ease-out;
}

.user-card:hover { 
    transform: translateY(-8px) scale(1.05); 
    box-shadow: 0 25px 50px rgba(139,92,246,0.4);
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(40px) scale(0.8); } 
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.pulse-ring {
    animation: pulseRing 2s infinite;
}

@keyframes pulseRing {
    0% { transform: scale(1); opacity: 1; } 
    50% { transform: scale(1.15); opacity: 0.7; } 
    100% { transform: scale(1); opacity: 1; }
}

.glow-effect {
    box-shadow: 0 0 20px rgba(139,92,246,0.6); 
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from { box-shadow: 0 0 20px rgba(139,92,246,0.6); } 
    to { box-shadow: 0 0 30px rgba(139,92,246,0.8); }
}
</style>

<!-- Script -->
<script>
// Your VPS endpoint
const API_BASE = 'http://162.250.191.81:4000';

const usernameInput = document.getElementById('usernameInput');
const submitBtn = document.getElementById('submitBtn');
const hallOfFame = document.getElementById('hallOfFame');
const musicToggle = document.getElementById('musicToggle');
const connectionStatus = document.getElementById('connectionStatus');
const userCount = document.getElementById('userCount');
const errorMsg = document.getElementById('errorMsg');

let musicPlaying = false;

// Create audio element for background music
const bgMusic = new Audio();
bgMusic.loop = true;
bgMusic.volume = 0.3;

// Music toggle functionality
musicToggle.addEventListener('click', async () => {
    try {
        if (musicPlaying) { 
            bgMusic.pause(); 
            musicToggle.innerHTML = 'üéµ Play Music'; 
            musicPlaying = false; 
        } else {
            // Try to play music if available
            try {
                await bgMusic.play();
                musicToggle.innerHTML = 'üîá Pause Music'; 
                musicPlaying = true;
            } catch(e) {
                console.log('No audio file available');
                musicToggle.innerHTML = 'üéµ No Audio';
                musicToggle.disabled = true;
            }
        }
    } catch(e) { 
        console.log('Music error:', e);
    }
});

// Show error/success message
function showMessage(message, isError = true) {
    errorMsg.textContent = message;
    errorMsg.className = `mt-2 text-center ${isError ? 'text-red-400' : 'text-green-400'}`;
    errorMsg.classList.remove('hidden');
    
    setTimeout(() => {
        errorMsg.classList.add('hidden');
    }, 5000);
}

// Check VPS connection
async function checkConnection() {
    try {
        console.log('Testing connection to VPS...');
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 8000);
        
        const response = await fetch(`${API_BASE}/`, {
            method: 'GET',
            signal: controller.signal,
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        clearTimeout(timeoutId);
        
        if (response.ok) {
            const data = await response.json();
            console.log('Connection successful:', data);
            connectionStatus.innerHTML = '<span class="text-green-400">‚úÖ Connected to Server</span>'; 
            return true;
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
    } catch(error) { 
        console.error('Connection failed:', error);
        
        if (error.name === 'AbortError') {
            connectionStatus.innerHTML = '<span class="text-red-400">‚ùå Connection timeout</span>';
        } else {
            connectionStatus.innerHTML = '<span class="text-red-400">‚ùå Server unavailable</span>';
        }
        return false;
    }
}

// Load users from server
async function loadUsers() {
    try {
        console.log('Loading users...');
        
        const response = await fetch(`${API_BASE}/users`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        if (response.ok) {
            const users = await response.json();
            console.log('Loaded users:', users);
            
            hallOfFame.innerHTML = '';
            
            if (users.length === 0) { 
                userCount.textContent = 'No legends yet - be the first!'; 
                return; 
            }
            
            // Add users with staggered animation
            users.forEach((username, index) => {
                setTimeout(() => addUserCard(username), index * 100);
            });
            
            userCount.textContent = `${users.length} digital legend${users.length === 1 ? '' : 's'}`;
        } else {
            throw new Error(`Failed to load users: ${response.status}`);
        }
    } catch(error) { 
        console.error('Error loading users:', error);
        userCount.textContent = 'Failed to load users';
    }
}

// Save user to server
async function saveUser(username) {
    try {
        console.log('Saving user:', username);
        
        const response = await fetch(`${API_BASE}/users`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username: username })
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('User saved successfully:', result);
            return result;
        } else {
            const errorText = await response.text();
            throw new Error(`Server error: ${response.status}`);
        }
    } catch(error) { 
        console.error('Error saving user:', error);
        throw error;
    }
}

// Add user card to hall of fame
function addUserCard(username) {
    const card = document.createElement('div');
    card.className = 'user-card bg-gradient-to-br from-purple-600/30 to-pink-600/30 backdrop-blur-sm rounded-2xl p-4 border border-purple-500/40 text-center glow-effect';
    
    // Avatar with multiple fallback sources
    const avatarContainer = document.createElement('div');
    avatarContainer.className = 'mb-3 relative';
    
    const avatar = document.createElement('img');
    avatar.className = 'w-16 h-16 rounded-full mx-auto border-2 border-purple-400 shadow-xl';
    avatar.alt = `${username} avatar`;
    
    const avatarSources = [
        `https://unavatar.io/twitter/${username}`,
        `https://github.com/${username}.png`,
        `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`
    ];
    
    let sourceIndex = 0;
    
    const tryLoadAvatar = () => {
        if (sourceIndex < avatarSources.length) {
            avatar.src = avatarSources[sourceIndex];
            sourceIndex++;
        } else {
            // All sources failed, show fallback
            avatar.style.display = 'none';
            const fallback = document.createElement('div');
            fallback.className = 'w-16 h-16 rounded-full mx-auto border-2 border-purple-400 shadow-xl bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-2xl font-bold';
            fallback.textContent = username.charAt(0).toUpperCase();
            avatarContainer.appendChild(fallback);
        }
    };
    
    avatar.onerror = tryLoadAvatar;
    tryLoadAvatar(); // Start loading first source
    
    avatarContainer.appendChild(avatar);
    
    // User info
    const userInfo = document.createElement('div');
    userInfo.innerHTML = `
        <h3 class="font-bold text-white mb-1">@${username}</h3>
        <div class="text-xs text-purple-300">Digital Legend</div>
    `;
    
    card.appendChild(avatarContainer);
    card.appendChild(userInfo);
    hallOfFame.appendChild(card);
}

// Submit new user
submitBtn.addEventListener('click', async () => {
    const username = usernameInput.value.trim().replace('@', '');
    
    if (!username) { 
        showMessage('Please enter a Twitter username');
        usernameInput.focus();
        return;
    }
    
    if (username.length < 1 || username.length > 50) {
        showMessage('Username must be between 1-50 characters');
        return;
    }
    
    // Disable submit button during request
    submitBtn.disabled = true;
    submitBtn.textContent = '‚è≥ Joining...';
    
    try {
        await saveUser(username);
        await loadUsers();
        
        usernameInput.value = '';
        showMessage(`Welcome to the Hall of Fame, @${username}! üéâ`, false);
        
    } catch (error) {
        console.error('Failed to add user:', error);
        showMessage(`Failed to join: ${error.message}`);
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üöÄ Join the Wall';
    }
});

// Enter key support
usernameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !submitBtn.disabled) {
        submitBtn.click();
    }
});

// Initialize the app
async function init() {
    console.log('üöÄ Initializing Plasma Hall of Fame...');
    
    const connected = await checkConnection();
    if (connected) {
        await loadUsers();
    }
    
    console.log('‚úÖ Initialization complete');
}

// Start the app
init();
</script>

</body>
</html>
