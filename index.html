<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Plasma Wall - Enhanced</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen text-white overflow-hidden relative" style="background: radial-gradient(ellipse at center, #0f3b2f 0%, #0a2f24 25%, #052519 50%, #021910 100%);">

<!-- Enhanced Background Effects -->
<div class="absolute inset-0 overflow-hidden">
    <!-- Multi-layer star system -->
    <div class="stars-layer-1 absolute inset-0"></div>
    <div class="stars-layer-2 absolute inset-0"></div>
    <div class="stars-layer-3 absolute inset-0"></div>
    
    <!-- Central plasma portal -->
    <div class="plasma-portal absolute inset-0 flex items-center justify-center">
        <div class="portal-outer-ring"></div>
        <div class="portal-middle-ring"></div>
        <div class="portal-inner-core"></div>
    </div>
    
    <!-- Floating particles -->
    <div class="floating-particles absolute inset-0"></div>
    
    <!-- Plasma energy waves -->
    <div class="plasma-energy absolute inset-0"></div>
    
    <!-- Green aurora effect -->
    <div class="aurora-effect absolute inset-0"></div>
</div>

<!-- Audio -->
<audio id="bgMusic" loop preload="auto" style="display: none;">
    <source src="./interstellar.mp3" type="audio/mpeg">
    <source src="./interstellar.wav" type="audio/wav">
    <source src="./music.mp3" type="audio/mpeg">
</audio>

<!-- Enhanced Header -->
<header class="relative z-10 text-center py-10">
    <h1 class="text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-200 via-green-300 to-green-400 mb-6 plasma-title">
        🕊 PLASMA WALL 🕊
    </h1>
    <p class="text-green-100 text-2xl font-light tracking-wider mb-2">Join the Cosmic Community</p>
    <p class="text-green-300 text-lg font-medium">Where digital souls unite in the plasma field</p>
</header>

<!-- Enhanced Stats Section -->
<div class="relative z-10 flex justify-center mb-10">
    <div class="plasma-stats-card bg-black/80 backdrop-blur-xl rounded-3xl px-10 py-6 border-2 border-green-400/60">
        <div id="userCount" class="text-green-200 font-bold text-2xl flex items-center justify-center gap-4">
            <span class="text-3xl animate-bounce">🕊</span>
            <span>Loading plasma network...</span>
            <span class="text-3xl animate-bounce">🕊</span>
        </div>
    </div>
</div>

<!-- Enhanced Input Section -->
<div class="relative z-10 flex flex-col items-center justify-center px-6 mb-16">
    <div class="flex items-center gap-8 max-w-6xl w-full mb-8">
        <input 
            type="text" 
            id="usernameInput" 
            placeholder="Enter your Twitter/X username (without @)" 
            class="flex-1 px-10 py-6 rounded-2xl text-gray-900 bg-white/98 focus:outline-none focus:ring-4 focus:ring-green-400/80 text-xl font-semibold backdrop-blur-sm shadow-2xl transition-all duration-300 hover:shadow-green-400/40 border-3 border-transparent focus:border-green-400/70 placeholder-gray-500"
        >
        <button 
            id="submitBtn" 
            class="px-12 py-6 bg-gradient-to-br from-green-400 via-green-500 to-green-600 hover:from-green-500 hover:via-green-600 hover:to-green-700 rounded-2xl font-bold transition-all duration-300 text-xl shadow-2xl hover:shadow-green-400/50 transform hover:scale-105 border-2 border-green-300/40 plasma-button"
        >
            🕊 JOIN PLASMA 🕊
        </button>
    </div>
    
    <div class="flex gap-8 mb-6">
        <button 
            id="musicToggle" 
            class="px-8 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 rounded-xl font-semibold transition-all duration-300 shadow-xl transform hover:scale-105 border border-green-400/40"
        >
            🎵 Cosmic Soundtrack
        </button>
        
        <button 
            id="refreshBtn" 
            class="px-8 py-4 bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 rounded-xl font-semibold transition-all duration-300 shadow-xl transform hover:scale-105 border border-green-400/40"
        >
            🔄 Refresh Network
        </button>
    </div>
    
    <div id="connectionStatus" class="text-center text-green-200 font-bold text-lg bg-black/70 backdrop-blur-xl rounded-2xl px-8 py-4 border-2 border-green-500/30 plasma-status">
        Connecting to plasma network...
    </div>
</div>

<!-- Enhanced Moving Wall Container -->
<div class="relative z-10 px-6 pb-10">
    <div class="plasma-wall-container bg-black/70 backdrop-blur-2xl rounded-4xl p-12 border-3 border-green-400/50 max-w-8xl mx-auto overflow-hidden shadow-2xl">        
        <!-- Moving Wall -->
        <div class="wall-viewport relative h-[420px] overflow-hidden rounded-3xl border-2 border-green-500/40">
            <div id="movingWall" class="moving-wall-track absolute top-0 left-0 flex items-center gap-8 py-8"></div>
        </div>
        
        <div class="flex justify-between items-center mt-10 text-lg">
            <div class="text-green-300 font-bold flex items-center gap-3">
                <span class="text-2xl animate-pulse">🕊</span>
                <span>Crafted by @aabis</span>
                <span class="text-2xl animate-pulse">🕊</span>
            </div>
            <div id="lastUpdated" class="text-green-200/90 font-semibold">Network Status: Initializing</div>
        </div>
    </div>
</div>

<!-- Enhanced Styles -->
<style>
/* Enhanced plasma title effect */
.plasma-title {
    text-shadow: 
        0 0 15px rgba(34, 197, 94, 1),
        0 0 30px rgba(34, 197, 94, 0.8),
        0 0 45px rgba(34, 197, 94, 0.6),
        0 0 60px rgba(34, 197, 94, 0.4);
    animation: plasmaTitle 4s ease-in-out infinite alternate;
    filter: drop-shadow(0 0 20px rgba(34, 197, 94, 0.5));
}

@keyframes plasmaTitle {
    0% { 
        text-shadow: 0 0 15px rgba(34, 197, 94, 1), 0 0 30px rgba(34, 197, 94, 0.8), 0 0 45px rgba(34, 197, 94, 0.6);
        transform: scale(1);
    }
    100% { 
        text-shadow: 0 0 25px rgba(34, 197, 94, 1), 0 0 40px rgba(34, 197, 94, 0.9), 0 0 55px rgba(34, 197, 94, 0.7);
        transform: scale(1.02);
    }
}

/* Enhanced card effects */
.plasma-stats-card {
    background: linear-gradient(135deg, 
        rgba(0,0,0,0.9) 0%, 
        rgba(6,78,59,0.4) 30%, 
        rgba(5,46,38,0.6) 70%, 
        rgba(0,0,0,0.9) 100%);
    box-shadow: 
        0 0 40px rgba(34, 197, 94, 0.3),
        inset 0 2px 0 rgba(34, 197, 94, 0.2),
        0 8px 32px rgba(0, 0, 0, 0.4);
}

.plasma-wall-container {
    background: linear-gradient(135deg, 
        rgba(0,0,0,0.8) 0%, 
        rgba(6,78,59,0.3) 20%, 
        rgba(5,46,38,0.4) 50%, 
        rgba(6,78,59,0.3) 80%, 
        rgba(0,0,0,0.8) 100%);
    box-shadow: 
        0 0 50px rgba(34, 197, 94, 0.2),
        inset 0 2px 0 rgba(34, 197, 94, 0.1),
        0 20px 60px rgba(0, 0, 0, 0.4);
}

.plasma-button {
    background: linear-gradient(135deg, 
        #22c55e 0%, 
        #16a34a 25%, 
        #15803d 50%, 
        #16a34a 75%, 
        #22c55e 100%);
    background-size: 200% 200%;
    animation: plasmaButtonFlow 3s ease-in-out infinite;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    box-shadow: 
        0 0 20px rgba(34, 197, 94, 0.4),
        0 8px 25px rgba(0, 0, 0, 0.3);
}

@keyframes plasmaButtonFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.plasma-status {
    background: linear-gradient(135deg, 
        rgba(0,0,0,0.8) 0%, 
        rgba(6,78,59,0.5) 100%);
    box-shadow: 
        0 0 30px rgba(34, 197, 94, 0.2),
        inset 0 1px 0 rgba(34, 197, 94, 0.1);
}

/* Advanced multi-layer star system */
.stars-layer-1 {
    background-image: 
        radial-gradient(2px 2px at 5% 15%, rgba(34, 197, 94, 0.9), transparent),
        radial-gradient(1px 1px at 25% 45%, rgba(255,255,255,0.8), transparent),
        radial-gradient(3px 3px at 45% 75%, rgba(16, 185, 129, 0.7), transparent),
        radial-gradient(2px 2px at 65% 25%, rgba(34, 197, 94, 0.8), transparent),
        radial-gradient(1px 1px at 85% 65%, rgba(255,255,255,0.9), transparent),
        radial-gradient(2px 2px at 15% 85%, rgba(5, 150, 105, 0.8), transparent),
        radial-gradient(1px 1px at 75% 5%, rgba(34, 197, 94, 0.7), transparent),
        radial-gradient(3px 3px at 95% 95%, rgba(16, 185, 129, 0.9), transparent);
    background-size: 400px 300px, 350px 400px, 500px 250px, 300px 350px, 450px 300px, 380px 280px, 320px 420px, 280px 380px;
    animation: starsLayer1 180s linear infinite;
    opacity: 0.7;
}

.stars-layer-2 {
    background-image: 
        radial-gradient(4px 4px at 20% 30%, rgba(6, 182, 212, 0.6), transparent),
        radial-gradient(3px 3px at 60% 70%, rgba(34, 197, 94, 0.8), transparent),
        radial-gradient(2px 2px at 40% 10%, rgba(255,255,255,0.7), transparent),
        radial-gradient(5px 5px at 80% 50%, rgba(16, 185, 129, 0.9), transparent),
        radial-gradient(2px 2px at 10% 90%, rgba(34, 197, 94, 0.6), transparent),
        radial-gradient(3px 3px at 90% 20%, rgba(5, 150, 105, 0.8), transparent);
    background-size: 600px 400px, 450px 500px, 380px 320px, 520px 280px, 340px 460px, 480px 360px;
    animation: starsLayer2 120s linear infinite reverse;
    opacity: 0.8;
}

.stars-layer-3 {
    background-image: 
        radial-gradient(6px 6px at 30% 60%, rgba(34, 197, 94, 1), transparent),
        radial-gradient(4px 4px at 70% 30%, rgba(255,255,255,0.9), transparent),
        radial-gradient(5px 5px at 50% 90%, rgba(16, 185, 129, 0.8), transparent),
        radial-gradient(3px 3px at 90% 80%, rgba(34, 197, 94, 0.9), transparent);
    background-size: 800px 500px, 600px 400px, 700px 350px, 450px 550px;
    animation: starsLayer3 200s linear infinite;
    opacity: 0.9;
}

@keyframes starsLayer1 {
    0% { transform: translate(0, 0) rotate(0deg); }
    100% { transform: translate(-120px, -60px) rotate(360deg); }
}

@keyframes starsLayer2 {
    0% { transform: translate(0, 0) rotate(0deg); }
    100% { transform: translate(100px, -100px) rotate(-360deg); }
}

@keyframes starsLayer3 {
    0% { transform: translate(0, 0) rotate(0deg); }
    100% { transform: translate(-80px, 50px) rotate(180deg); }
}

/* Enhanced portal system */
.plasma-portal {
    pointer-events: none;
}

.portal-outer-ring {
    width: 800px;
    height: 800px;
    border-radius: 50%;
    background: conic-gradient(
        from 0deg,
        transparent 0deg,
        rgba(34, 197, 94, 0.4) 15deg,
        rgba(16, 185, 129, 0.6) 30deg,
        transparent 50deg,
        transparent 70deg,
        rgba(5, 150, 105, 0.5) 90deg,
        rgba(34, 197, 94, 0.7) 105deg,
        transparent 130deg,
        transparent 150deg,
        rgba(16, 185, 129, 0.4) 170deg,
        transparent 190deg,
        transparent 210deg,
        rgba(34, 197, 94, 0.6) 230deg,
        rgba(5, 150, 105, 0.5) 245deg,
        transparent 270deg,
        transparent 290deg,
        rgba(16, 185, 129, 0.7) 310deg,
        transparent 330deg,
        transparent 360deg
    );
    mask: radial-gradient(circle, transparent 15%, black 17%, black 83%, transparent 85%);
    -webkit-mask: radial-gradient(circle, transparent 15%, black 17%, black 83%, transparent 85%);
    animation: portalOuterSpin 40s linear infinite;
    filter: blur(2px);
    opacity: 0.6;
}

.portal-middle-ring {
    position: absolute;
    width: 500px;
    height: 500px;
    border-radius: 50%;
    background: conic-gradient(
        from 180deg,
        transparent 0deg,
        rgba(34, 197, 94, 0.8) 20deg,
        rgba(16, 185, 129, 0.9) 40deg,
        transparent 70deg,
        transparent 110deg,
        rgba(5, 150, 105, 0.7) 140deg,
        rgba(34, 197, 94, 1) 160deg,
        transparent 190deg,
        transparent 230deg,
        rgba(16, 185, 129, 0.6) 250deg,
        transparent 280deg,
        transparent 360deg
    );
    mask: radial-gradient(circle, transparent 25%, black 27%, black 73%, transparent 75%);
    -webkit-mask: radial-gradient(circle, transparent 25%, black 27%, black 73%, transparent 75%);
    animation: portalMiddleSpin 25s linear infinite reverse;
    filter: blur(1px);
    opacity: 0.7;
}

.portal-inner-core {
    position: absolute;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, 
        rgba(34, 197, 94, 0.8) 0%, 
        rgba(16, 185, 129, 0.6) 20%, 
        rgba(5, 150, 105, 0.4) 40%,
        transparent 60%);
    border-radius: 50%;
    animation: portalCorePulse 6s ease-in-out infinite alternate;
    filter: blur(0.5px);
}

@keyframes portalOuterSpin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes portalMiddleSpin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes portalCorePulse {
    0% { transform: scale(0.8); opacity: 0.6; }
    100% { transform: scale(1.3); opacity: 1; }
}

/* Enhanced floating particles */
.floating-particles {
    background-image: 
        radial-gradient(4px 4px at 10% 20%, rgba(34, 197, 94, 0.9), transparent),
        radial-gradient(3px 3px at 30% 60%, rgba(16, 185, 129, 1), transparent),
        radial-gradient(5px 5px at 50% 40%, rgba(5, 150, 105, 0.8), transparent),
        radial-gradient(2px 2px at 70% 80%, rgba(34, 197, 94, 0.9), transparent),
        radial-gradient(4px 4px at 90% 30%, rgba(16, 185, 129, 0.7), transparent),
        radial-gradient(3px 3px at 20% 90%, rgba(34, 197, 94, 0.8), transparent),
        radial-gradient(6px 6px at 60% 10%, rgba(5, 150, 105, 0.9), transparent),
        radial-gradient(2px 2px at 80% 70%, rgba(16, 185, 129, 0.8), transparent);
    background-size: 900px 500px, 700px 700px, 800px 400px, 600px 600px, 1000px 350px, 500px 800px, 750px 450px, 400px 900px;
    animation: particleSwim 40s linear infinite;
    opacity: 0.8;
}

@keyframes particleSwim {
    0% { transform: translate(0, 0) rotate(0deg); }
    25% { transform: translate(-100px, -80px) rotate(90deg); }
    50% { transform: translate(-200px, 60px) rotate(180deg); }
    75% { transform: translate(-80px, -100px) rotate(270deg); }
    100% { transform: translate(0, 0) rotate(360deg); }
}

/* Plasma energy waves */
.plasma-energy {
    background: 
        radial-gradient(ellipse 1000px 500px at 25% 60%, rgba(34, 197, 94, 0.12), transparent),
        radial-gradient(ellipse 800px 400px at 75% 40%, rgba(16, 185, 129, 0.1), transparent),
        radial-gradient(ellipse 900px 450px at 50% 80%, rgba(5, 150, 105, 0.15), transparent);
    animation: plasmaEnergyFlow 60s ease-in-out infinite alternate;
}

@keyframes plasmaEnergyFlow {
    0% { 
        transform: scale(1) rotate(0deg); 
        opacity: 0.5; 
    }
    33% {
        transform: scale(1.1) rotate(1deg); 
        opacity: 0.7; 
    }
    66% {
        transform: scale(0.9) rotate(-1deg); 
        opacity: 0.6; 
    }
    100% { 
        transform: scale(1.05) rotate(0.5deg); 
        opacity: 0.4; 
    }
}

/* Aurora effect */
.aurora-effect {
    background: 
        linear-gradient(90deg, 
            transparent 0%, 
            rgba(34, 197, 94, 0.1) 20%, 
            rgba(16, 185, 129, 0.15) 40%, 
            rgba(5, 150, 105, 0.1) 60%, 
            rgba(34, 197, 94, 0.12) 80%, 
            transparent 100%);
    transform: rotate(-10deg) scale(1.5);
    animation: auroraShimmer 25s ease-in-out infinite alternate;
    opacity: 0.6;
}

@keyframes auroraShimmer {
    0% { 
        transform: rotate(-10deg) scale(1.5) translateX(-100px); 
        opacity: 0.4; 
    }
    50% {
        transform: rotate(-8deg) scale(1.6) translateX(0px); 
        opacity: 0.8; 
    }
    100% { 
        transform: rotate(-12deg) scale(1.4) translateX(100px); 
        opacity: 0.3; 
    }
}

/* Enhanced moving wall */
.wall-viewport {
    background: linear-gradient(135deg, 
        rgba(0,0,0,0.5) 0%, 
        rgba(6,78,59,0.2) 30%,
        rgba(5,46,38,0.3) 50%,
        rgba(6,78,59,0.2) 70%,
        rgba(0,0,0,0.5) 100%);
    mask: linear-gradient(90deg, transparent 0%, black 10%, black 90%, transparent 100%);
    -webkit-mask: linear-gradient(90deg, transparent 0%, black 10%, black 90%, transparent 100%);
    box-shadow: 
        inset 0 0 30px rgba(34, 197, 94, 0.1),
        0 0 20px rgba(0, 0, 0, 0.3);
}

.moving-wall-track {
    animation: wallFlow 80s linear infinite;
    will-change: transform;
}

@keyframes wallFlow {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
}

/* Enhanced user cards */
.user-card {
    flex-shrink: 0;
    width: 180px;
    height: 180px;
    position: relative;
    transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
    margin: 0 10px;
    transform-style: preserve-3d;
}

.user-card:hover {
    transform: scale(1.3) translateY(-20px) rotateY(15deg) rotateZ(2deg);
    z-index: 30;
}

.profile-container {
    width: 100%;
    height: 100%;
    position: relative;
    border-radius: 24px;
    overflow: hidden;
    background: linear-gradient(135deg, 
        #16a34a 0%, 
        #22c55e 25%, 
        #10b981 50%, 
        #059669 75%, 
        #047857 100%);
    background-size: 200% 200%;
    animation: profileGradientFlow 8s ease-in-out infinite;
    border: 4px solid rgba(34, 197, 94, 0.9);
    box-shadow: 
        0 0 40px rgba(34, 197, 94, 0.5),
        0 15px 50px rgba(0, 0, 0, 0.4),
        inset 0 2px 0 rgba(255, 255, 255, 0.2);
    transition: all 0.5s ease;
}

@keyframes profileGradientFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.user-card:hover .profile-container {
    border-color: #10b981;
    box-shadow: 
        0 0 60px rgba(34, 197, 94, 0.8),
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 2px 0 rgba(255, 255, 255, 0.3);
    transform: rotateX(10deg);
}

.profile-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: all 0.5s ease;
    border-radius: 20px;
}

.user-card:hover .profile-img {
    transform: scale(1.1) rotateZ(-2deg);
    filter: brightness(1.1) contrast(1.1);
}

.username-badge {
    position: absolute;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, 
        rgba(0,0,0,0.95) 0%, 
        rgba(6,78,59,0.9) 30%,
        rgba(5,46,38,0.95) 70%,
        rgba(0,0,0,0.95) 100%);
    color: #22c55e;
    text-align: center;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 25px;
    border: 3px solid rgba(34, 197, 94, 0.8);
    backdrop-filter: blur(20px);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    transition: all 0.5s ease;
    min-width: 140px;
    box-shadow: 
        0 5px 20px rgba(0, 0, 0, 0.4),
        0 0 15px rgba(34, 197, 94, 0.3);
}

.user-card:hover .username-badge {
    background: linear-gradient(135deg, 
        rgba(34, 197, 94, 0.95) 0%, 
        rgba(16, 185, 129, 0.95) 50%, 
        rgba(5, 150, 105, 0.95) 100%);
    color: white;
    border-color: #10b981;
    transform: translateX(-50%) translateY(-5px) scale(1.08);
    box-shadow: 
        0 8px 25px rgba(34, 197, 94, 0.4),
        0 0 20px rgba(34, 197, 94, 0.6);
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
}

/* Enhanced loading states */
.loading-state {
    background: linear-gradient(135deg, 
        #064e3b 0%, 
        #0f766e 25%, 
        #047857 50%, 
        #059669 75%, 
        #10b981 100%);
    background-size: 300% 300%;
    animation: loadingFlow 3s infinite;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ffffff;
    font-size: 36px;
    font-weight: bold;
    text-shadow: 0 3px 6px rgba(0, 0, 0, 0.6);
    position: relative;
    overflow: hidden;
}

.loading-state::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, 
        transparent, 
        rgba(34, 197, 94, 0.2), 
        transparent);
    animation: loadingShimmer 2s infinite;
}

@keyframes loadingFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes loadingShimmer {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Letter avatar for failed loads */
.letter-avatar {
    background: linear-gradient(135deg, 
        #16a34a 0%, 
        #22c55e 25%, 
        #10b981 50%, 
        #059669 75%, 
        #047857 100%);
    background-size: 200% 200%;
    animation: letterAvatarFlow 6s ease-in-out infinite;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 48px;
    font-weight: bold;
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
    position: relative;
    overflow: hidden;
}

@keyframes letterAvatarFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.letter-avatar::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, 
        transparent, 
        rgba(255, 255, 255, 0.15), 
        transparent);
    animation: letterShine 4s infinite;
}

@keyframes letterShine {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Success animations */
@keyframes successPulse {
    0% { 
        transform: scale(1); 
        box-shadow: 0 0 40px rgba(34, 197, 94, 0.5); 
    }
    50% { 
        transform: scale(1.1); 
        box-shadow: 0 0 60px rgba(34, 197, 94, 0.9); 
    }
    100% { 
        transform: scale(1); 
        box-shadow: 0 0 40px rgba(34, 197, 94, 0.5); 
    }
}

.success-animation {
    animation: successPulse 1s ease-in-out;
}

/* Celebration particles */
@keyframes celebrate {
    0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
    100% {
        transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(0);
        opacity: 0;
    }
}

/* Responsive design */
@media (max-width: 768px) {
    .plasma-title {
        font-size: 4rem;
    }
    
    .user-card {
        width: 140px;
        height: 140px;
    }
    
    .username-badge {
        font-size: 12px;
        padding: 8px 16px;
        min-width: 120px;
    }
}
</style>

<!-- Enhanced JavaScript -->
<script>
// Enhanced Configuration
const CONFIG = {
    SERVER_URL: 'http://162.250.191.81:4000',
    CORS_PROXIES: [
        'https://api.allorigins.win/raw?url=',
        'https://corsproxy.io/?',
        'https://cors-anywhere.herokuapp.com/'
    ],
    TIMEOUT: 6000,
    MAX_RETRIES: 2,
    RETRY_DELAY: 1000,
    AUTO_SYNC_INTERVAL: 30000
};

// Storage keys
const STORAGE_KEY = 'plasma_wall_users_v4';
const METADATA_KEY = 'plasma_wall_metadata_v4';

// DOM elements
const elements = {
    usernameInput: document.getElementById('usernameInput'),
    submitBtn: document.getElementById('submitBtn'),
    refreshBtn: document.getElementById('refreshBtn'),
    movingWall: document.getElementById('movingWall'),
    bgMusic: document.getElementById('bgMusic'),
    musicToggle: document.getElementById('musicToggle'),
    connectionStatus: document.getElementById('connectionStatus'),
    userCount: document.getElementById('userCount'),
    lastUpdated: document.getElementById('lastUpdated')
};

// Application state
let state = {
    musicPlaying: false,
    isConnected: false,
    autoSyncInterval: null,
    allUsers: ['proofofnathan', 'scene999', 'MaxApoz', 'shadowofthefax'],
    defaultUsers: ['proofofnathan', 'scene999', 'MaxApoz', 'shadowofthefax']
};

// Utility functions
const utils = {
    getCurrentTime: () => new Date().toLocaleString(),
    
    cleanUsername: (username) => {
        return username.replace('@', '').replace(/[^a-zA-Z0-9_]/g, '').toLowerCase();
    },
    
    validateUsername: (username) => {
        const clean = utils.cleanUsername(username);
        if (!clean || clean.length < 1) return { valid: false, message: 'Please enter a username' };
        if (clean.length > 15) return { valid: false, message: 'Username too long (max 15 characters)' };
        if (state.allUsers.includes(clean)) return { valid: false, message: 'User already in Plasma Wall! 🕊' };
        return { valid: true, username: clean };
    },

    delay: (ms) => new Promise(resolve => setTimeout(resolve, ms)),
    
    updateStatus: (message, type = 'info') => {
        elements.connectionStatus.innerHTML = message;
        const baseClasses = 'text-center font-bold text-lg bg-black/70 backdrop-blur-xl rounded-2xl px-8 py-4 border-2 border-green-500/30 plasma-status';
        elements.connectionStatus.className = `${baseClasses} ${
            type === 'success' ? 'text-green-200' : 
            type === 'error' ? 'text-red-300' : 
            type === 'warning' ? 'text-yellow-300' : 'text-green-200'
        }`;
    }
};

// Enhanced Storage Manager
const storage = {
    save: () => {
        try {
            const usersToSave = state.allUsers.filter(user => !state.defaultUsers.includes(user));
            const metadata = {
                savedAt: new Date().toISOString(),
                totalUsers: state.allUsers.length,
                version: '4.0'
            };
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(usersToSave));
            localStorage.setItem(METADATA_KEY, JSON.stringify(metadata));
            
            console.log('💾 Saved to localStorage:', { users: usersToSave.length, total: state.allUsers.length });
            return true;
        } catch (error) {
            console.error('❌ Storage save failed:', error);
            return false;
        }
    },
    
    load: () => {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            const metadata = localStorage.getItem(METADATA_KEY);
            
            if (saved && metadata) {
                const savedUsers = JSON.parse(saved);
                const meta = JSON.parse(metadata);
                
                state.allUsers = [...state.defaultUsers, ...savedUsers];
                
                console.log('📦 Loaded from localStorage:', { users: savedUsers.length, total: state.allUsers.length });
                
                if (meta.savedAt) {
                    elements.lastUpdated.textContent = `Last sync: ${new Date(meta.savedAt).toLocaleString()}`;
                }
                
                return savedUsers;
            }
        } catch (error) {
            console.error('❌ Storage load failed:', error);
        }
        return [];
    }
};

// FIXED Avatar Manager - Comprehensive fallback system
const avatarManager = {
    // More reliable avatar sources with better fallbacks
    sources: [
        // Twitter/X sources (most reliable for Twitter users)
        (username) => `https://unavatar.io/twitter/${username}`,
        (username) => `https://unavatar.io/x/${username}`,
        
        // Direct Twitter API attempts
        (username) => `https://pbs.twimg.com/profile_images/${username}`,
        
        // GitHub (many devs use same handle)
        (username) => `https://github.com/${username}.png?size=180`,
        (username) => `https://avatars.githubusercontent.com/${username}?s=180`,
        
        // Multi-platform services
        (username) => `https://unavatar.io/${username}`,
        (username) => `https://avatar.vercel.sh/${username}?size=180`,
        
        // Generated avatars with better quality
        (username) => `https://api.dicebear.com/8.x/personas/svg?seed=${username}&size=180&backgroundColor=22c55e,16a34a,059669`,
        (username) => `https://api.dicebear.com/8.x/adventurer/svg?seed=${username}&size=180&backgroundColor=047857,065f46`,
        (username) => `https://api.dicebear.com/8.x/big-smile/svg?seed=${username}&size=180&backgroundColor=16a34a`,
        
        // Robohash with green theme
        (username) => `https://robohash.org/${username}?size=180x180&set=set4&bgset=bg1&color=green`,
        (username) => `https://robohash.org/${username}?size=180x180&set=set1&bgset=bg2`,
        
        // Final fallback
        (username) => `https://ui-avatars.com/api/?name=${encodeURIComponent(username.charAt(0).toUpperCase())}&background=16a34a&color=fff&size=180&bold=true&font-size=0.4`
    ],
    
    loadAvatar: async (username, imgElement, container) => {
        console.log(`🖼️ Loading avatar for: ${username}`);
        
        // Set initial loading state
        container.classList.add('loading-state');
        container.textContent = '🕊';
        
        let loadSuccess = false;
        
        for (let i = 0; i < avatarManager.sources.length && !loadSuccess; i++) {
            try {
                const src = avatarManager.sources[i](username);
                console.log(`  📡 Trying source ${i + 1}/${avatarManager.sources.length} for ${username}`);
                
                loadSuccess = await new Promise((resolve) => {
                    const timeout = setTimeout(() => {
                        console.log(`  ⏰ Timeout for ${username} source ${i + 1}`);
                        resolve(false);
                    }, 4000);
                    
                    // Create new image to test loading
                    const testImg = new Image();
                    
                    testImg.onload = () => {
                        clearTimeout(timeout);
                        // Check if image is valid (not 1x1 pixel or broken)
                        if (testImg.naturalWidth > 10 && testImg.naturalHeight > 10) {
                            console.log(`  ✅ Avatar loaded for ${username} from source ${i + 1}`);
                            // Success - update the actual image
                            imgElement.src = src;
                            imgElement.onload = () => {
                                container.classList.remove('loading-state');
                                container.textContent = '';
                                imgElement.style.display = 'block';
                            };
                            resolve(true);
                        } else {
                            console.log(`  ❌ Invalid image size for ${username} from source ${i + 1}`);
                            resolve(false);
                        }
                    };
                    
                    testImg.onerror = () => {
                        clearTimeout(timeout);
                        console.log(`  ❌ Source ${i + 1} failed for ${username}`);
                        resolve(false);
                    };
                    
                    testImg.src = src;
                });
                
            } catch (error) {
                console.log(`  ❌ Exception in source ${i + 1} for ${username}:`, error.message);
            }
        }
        
        if (!loadSuccess) {
            console.log(`❌ All avatar sources failed for ${username}, creating letter avatar`);
            avatarManager.createLetterAvatar(username, container);
        }
        
        return loadSuccess;
    },
    
    createLetterAvatar: (username, container) => {
        container.classList.remove('loading-state');
        container.classList.add('letter-avatar');
        container.innerHTML = '';
        
        // Use first 1-2 letters based on username length
        const displayText = username.length <= 3 ? 
            username.toUpperCase() : 
            username.charAt(0).toUpperCase();
        
        container.textContent = displayText;
    }
};

// Enhanced User Card Creator
const cardCreator = {
    create: (username, isNew = false) => {
        console.log(`🎭 Creating card for: ${username}${isNew ? ' (NEW!)' : ''}`);
        
        const card = document.createElement('div');
        card.className = `user-card ${isNew ? 'success-animation' : ''}`;
        
        const container = document.createElement('div');
        container.className = 'profile-container loading-state';
        container.textContent = '🕊';
        
        const img = document.createElement('img');
        img.className = 'profile-img';
        img.alt = username;
        img.style.display = 'none';
        
        const badge = document.createElement('div');
        badge.className = 'username-badge';
        badge.textContent = `@${username}`;
        
        container.appendChild(img);
        card.appendChild(container);
        card.appendChild(badge);
        
        // Add click handler to open Twitter profile
        card.addEventListener('click', () => {
            window.open(`https://twitter.com/${username}`, '_blank');
            // Visual feedback
            card.style.transform = 'scale(0.95)';
            setTimeout(() => card.style.transform = '', 150);
        });
        
        // Load avatar asynchronously with improved system
        avatarManager.loadAvatar(username, img, container);
        
        return card;
    }
};

// Enhanced Backend Manager
const backend = {
    makeRequest: async (url, options = {}) => {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), CONFIG.TIMEOUT);
        
        try {
            const response = await fetch(url, {
                ...options,
                signal: controller.signal,
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    ...options.headers
                }
            });
            
            clearTimeout(timeoutId);
            
            if (response.ok) {
                return await response.json();
            }
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        } catch (error) {
            clearTimeout(timeoutId);
            throw error;
        }
    },
    
    save: async (username) => {
        console.log('💾 Attempting to save to backend:', username);
        
        const methods = [
            // Direct connection first
            () => backend.makeRequest(`${CONFIG.SERVER_URL}/users`, {
                method: 'POST',
                body: JSON.stringify({ username: username })
            }),
            
            // CORS proxy methods
            ...CONFIG.CORS_PROXIES.map(proxy => () => 
                backend.makeRequest(`${proxy}${encodeURIComponent(CONFIG.SERVER_URL)}/users`, {
                    method: 'POST',
                    body: JSON.stringify({ username: username })
                })
            )
        ];
        
        for (let retry = 0; retry < CONFIG.MAX_RETRIES; retry++) {
            console.log(`🔄 Backend save attempt ${retry + 1}/${CONFIG.MAX_RETRIES}`);
            
            for (let i = 0; i < methods.length; i++) {
                try {
                    console.log(`  📡 Trying save method ${i + 1}/${methods.length}`);
                    await methods[i]();
                    console.log('✅ Successfully saved to backend!');
                    state.isConnected = true;
                    return true;
                } catch (error) {
                    console.log(`  ❌ Save method ${i + 1} failed: ${error.message}`);
                }
            }
            
            if (retry < CONFIG.MAX_RETRIES - 1) {
                console.log(`⏳ Waiting ${CONFIG.RETRY_DELAY}ms before retry...`);
                await utils.delay(CONFIG.RETRY_DELAY);
            }
        }
        
        console.error('❌ All backend save attempts failed');
        state.isConnected = false;
        return false;
    },
    
    load: async () => {
        console.log('📡 Loading users from backend...');
        
        const loadMethods = [
            { name: 'direct', url: `${CONFIG.SERVER_URL}/users` },
            ...CONFIG.CORS_PROXIES.map((proxy, index) => ({
                name: `proxy-${index + 1}`,
                url: `${proxy}${encodeURIComponent(CONFIG.SERVER_URL)}/users`
            }))
        ];
        
        for (const method of loadMethods) {
            try {
                console.log(`  🔄 Loading via ${method.name}...`);
                const serverUsers = await backend.makeRequest(method.url);
                
                console.log('✅ Loaded from backend:', serverUsers);
                
                // Merge with localStorage
                const savedUsers = storage.load();
                state.allUsers = [...new Set([...state.defaultUsers, ...serverUsers, ...savedUsers])];
                
                state.isConnected = true;
                utils.updateStatus('✅ Connected to plasma network 🕊', 'success');
                elements.lastUpdated.textContent = `Network Status: Connected • ${utils.getCurrentTime()}`;
                
                return true;
            } catch (error) {
                console.log(`  ❌ Load method ${method.name} failed: ${error.message}`);
            }
        }
        
        console.log('⚠️ Backend unavailable, using localStorage');
        storage.load();
        state.isConnected = false;
        utils.updateStatus('⚠️ Offline mode - using cached data', 'warning');
        elements.lastUpdated.textContent = `Network Status: Offline • ${utils.getCurrentTime()}`;
        
        return false;
    }
};

// Enhanced Wall Display Manager
const wallManager = {
    display: (highlightUser = null) => {
        console.log('🎯 Updating wall display:', { users: state.allUsers.length, highlight: highlightUser });
        
        elements.movingWall.innerHTML = '';
        
        // Update user count with dove emojis
        elements.userCount.innerHTML = `
            <span class="text-3xl animate-bounce">🕊</span>
            <span>${state.allUsers.length} Plasma Members</span>
            <span class="text-green-300 text-lg">• ${state.allUsers.length - state.defaultUsers.length} Community</span>
            <span class="text-3xl animate-bounce">🕊</span>
        `;
        
        const fragment = document.createDocumentFragment();
        
        // Create cards (doubled for seamless loop)
        [...state.allUsers, ...state.allUsers].forEach(username => {
            const isHighlighted = username === highlightUser;
            const card = cardCreator.create(username, isHighlighted);
            fragment.appendChild(card);
        });
        
        elements.movingWall.appendChild(fragment);
    }
};

// Enhanced Music Manager
const musicManager = {
    toggle: async () => {
        try {
            if (state.musicPlaying) {
                elements.bgMusic.pause();
                elements.musicToggle.innerHTML = '🎵 Cosmic Soundtrack';
                state.musicPlaying = false;
                console.log('🔇 Music paused');
            } else {
                elements.bgMusic.volume = 0.15;
                await elements.bgMusic.play();
                elements.musicToggle.innerHTML = '🔇 Stop Music';
                state.musicPlaying = true;
                console.log('🎵 Music playing');
                
                elements.musicToggle.classList.add('success-animation');
                setTimeout(() => elements.musicToggle.classList.remove('success-animation'), 1000);
            }
        } catch (error) {
            console.error('❌ Music error:', error);
            utils.updateStatus('⚠️ Music files not found - add audio files to folder', 'warning');
            setTimeout(() => {
                utils.updateStatus('✅ Ready to join plasma network 🕊', 'success');
            }, 4000);
        }
    }
};

// Enhanced User Submission
const userSubmission = {
    submit: async (username) => {
        const validation = utils.validateUsername(username);
        
        if (!validation.valid) {
            alert(validation.message);
            if (validation.message.includes('already in')) {
                userSubmission.highlightExisting(validation.username || username);
            }
            return;
        }
        
        const cleanUsername = validation.username;
        console.log('🚀 Processing submission:', cleanUsername);
        
        // UI feedback
        elements.submitBtn.disabled = true;
        elements.submitBtn.innerHTML = '🕊 JOINING PLASMA 🕊';
        utils.updateStatus('🌟 Adding to plasma network...', 'info');
        
        // Add to local state immediately
        state.allUsers.push(cleanUsername);
        storage.save();
        
        // Update display with highlight
        wallManager.display(cleanUsername);
        
        // Try backend save
        const backendSuccess = await backend.save(cleanUsername);
        
        // Update status based on result
        if (backendSuccess) {
            utils.updateStatus('✅ Successfully joined the Plasma Wall! 🕊🚀', 'success');
            elements.lastUpdated.textContent = `Network Status: Connected • ${utils.getCurrentTime()}`;
        } else {
            utils.updateStatus('✅ Joined locally! Will sync when network returns 🕊💫', 'warning');
        }
        
        // Success effects
        userSubmission.celebrationEffect();
        elements.usernameInput.value = '';
        elements.usernameInput.style.borderColor = '#22c55e';
        elements.usernameInput.style.transform = 'scale(1.02)';
        
        setTimeout(() => {
            elements.usernameInput.style.borderColor = '';
            elements.usernameInput.style.transform = '';
            elements.submitBtn.disabled = false;
            elements.submitBtn.innerHTML = '🕊 JOIN PLASMA 🕊';
            
            if (backendSuccess) {
                utils.updateStatus('✅ Connected to plasma network 🕊', 'success');
            } else {
                utils.updateStatus('⚠️ Offline mode - using cached data', 'warning');
            }
        }, 4000);
        
        console.log('✨ User successfully added to Plasma Wall');
    },
    
    highlightExisting: (username) => {
        const cleanUsername = utils.cleanUsername(username);
        setTimeout(() => {
            const cards = document.querySelectorAll('.user-card');
            cards.forEach(card => {
                const badge = card.querySelector('.username-badge');
                if (badge && badge.textContent === `@${cleanUsername}`) {
                    card.style.transform = 'scale(1.5) translateY(-25px)';
                    card.style.zIndex = '100';
                    card.style.filter = 'brightness(1.5) drop-shadow(0 0 30px rgba(34, 197, 94, 0.8))';
                    setTimeout(() => {
                        card.style.transform = '';
                        card.style.zIndex = '';
                        card.style.filter = '';
                    }, 3000);
                }
            });
        }, 100);
    },
    
    celebrationEffect: () => {
        const colors = ['#22c55e', '#16a34a', '#10b981', '#059669', '#047857'];
        
        // Create dove emoji particles
        for (let i = 0; i < 30; i++) {
            const particle = document.createElement('div');
            
            particle.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                font-size: 24px;
                pointer-events: none;
                z-index: 1000;
                user-select: none;
            `;
            
            particle.textContent = '🕊';
            
            const angle = (Math.PI * 2 * i) / 30;
            const velocity = 80 + Math.random() * 80;
            const x = Math.cos(angle) * velocity;
            const y = Math.sin(angle) * velocity;
            
            particle.style.setProperty('--x', `${x}px`);
            particle.style.setProperty('--y', `${y}px`);
            particle.style.animation = 'celebrate 2.5s ease-out forwards';
            
            document.body.appendChild(particle);
            
            setTimeout(() => particle.remove(), 2500);
        }
    }
};

// Auto-sync Manager
const autoSync = {
    start: () => {
        if (state.autoSyncInterval) return;
        
        state.autoSyncInterval = setInterval(async () => {
            if (!state.isConnected) {
                console.log('🔄 Auto-sync: Attempting reconnection...');
                const connected = await backend.load();
                if (connected) {
                    wallManager.display();
                    console.log('✅ Auto-sync: Reconnected successfully');
                }
            }
        }, CONFIG.AUTO_SYNC_INTERVAL);
        
        console.log('🔄 Auto-sync started (30s intervals)');
    },
    
    stop: () => {
        if (state.autoSyncInterval) {
            clearInterval(state.autoSyncInterval);
            state.autoSyncInterval = null;
            console.log('🛑 Auto-sync stopped');
        }
    }
};

// Event Listeners Setup
const setupEventListeners = () => {
    // Submit button
    elements.submitBtn.addEventListener('click', () => {
        const username = elements.usernameInput.value.trim();
        if (username) {
            userSubmission.submit(username);
        } else {
            elements.usernameInput.focus();
            elements.usernameInput.style.borderColor = '#ef4444';
            elements.usernameInput.style.transform = 'scale(1.02)';
            setTimeout(() => {
                elements.usernameInput.style.borderColor = '';
                elements.usernameInput.style.transform = '';
            }, 1000);
        }
    });
    
    // Enter key submit
    elements.usernameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !elements.submitBtn.disabled) {
            const username = elements.usernameInput.value.trim();
            if (username) userSubmission.submit(username);
        }
    });
    
    // Input validation with visual feedback
    elements.usernameInput.addEventListener('input', (e) => {
        const value = e.target.value;
        const clean = value.replace('@', '').replace(/[^a-zA-Z0-9_]/g, '');
        
        if (value !== clean) {
            e.target.value = clean;
        }
        
        // Real-time visual feedback
        if (clean.length === 0) {
            e.target.style.borderColor = '';
        } else if (clean.length > 15) {
            e.target.style.borderColor = '#ef4444';
        } else if (state.allUsers.includes(clean.toLowerCase())) {
            e.target.style.borderColor = '#f59e0b';
        } else {
            e.target.style.borderColor = '#22c55e';
        }
    });
    
    // Music toggle
    elements.musicToggle.addEventListener('click', musicManager.toggle);
    
    // Refresh button
    elements.refreshBtn.addEventListener('click', async () => {
        elements.refreshBtn.disabled = true;
        elements.refreshBtn.innerHTML = '🔄 Syncing...';
        elements.refreshBtn.classList.add('success-animation');
        
        utils.updateStatus('🔄 Syncing with plasma network...', 'info');
        
        try {
            const success = await backend.load();
            wallManager.display();
            
            if (success) {
                utils.updateStatus('✅ Plasma network synchronized! 🕊🚀', 'success');
            } else {
                utils.updateStatus('⚠️ Network unavailable - showing cached data', 'warning');
            }
        } catch (error) {
            console.error('❌ Refresh failed:', error);
            utils.updateStatus('❌ Sync failed - using cached data', 'error');
        }
        
        setTimeout(() => {
            elements.refreshBtn.disabled = false;
            elements.refreshBtn.innerHTML = '🔄 Refresh Network';
            elements.refreshBtn.classList.remove('success-animation');
        }, 2500);
    });
    
    // Cleanup handlers
    window.addEventListener('beforeunload', () => {
        autoSync.stop();
        if (state.musicPlaying) elements.bgMusic.pause();
    });
    
    document.addEventListener('visibilitychange', () => {
        if (document.hidden && state.musicPlaying) {
            elements.bgMusic.pause();
            elements.musicToggle.innerHTML = '🎵 Cosmic Soundtrack';
            state.musicPlaying = false;
        }
    });
};

// Enhanced Initialization
const init = async () => {
    console.log('🚀 Initializing Enhanced Plasma Wall v4.0...');
    console.log('🕊 Using dove emojis throughout the interface');
    console.log('🖼️ Fixed avatar loading with comprehensive fallback system');
    console.log('💾 Enhanced backend connectivity with multiple retry methods');
    console.log('🎨 Improved green aesthetic with plasma effects');
    
    setupEventListeners();
    
    // Show loading state
    utils.updateStatus('🌟 Initializing plasma network...', 'info');
    elements.userCount.innerHTML = `
        <span class="text-3xl animate-pulse">🕊</span>
        <span>Loading cosmic community...</span>
        <span class="text-3xl animate-pulse">🕊</span>
    `;
    
    elements.movingWall.innerHTML = `
        <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #22c55e; font-size: 3rem; font-weight: bold;">
            <span class="animate-pulse">🌌 Loading Plasma Wall 🕊</span>
        </div>
    `;
    
    try {
        // Load data from backend and localStorage
        const connected = await backend.load();
